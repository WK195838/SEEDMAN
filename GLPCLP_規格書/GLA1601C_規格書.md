# 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLA1601C
- **程式說明**：會計系統會計科目報表控制程式
- **程式語言**：CLP
- **程式位置**：QCLSRC_GLPLIB/GLA1601C
- **開發人員**：A1087 JOYCE
- **建立日期**：1992.12.11
- **系統名稱**：會計系統
- **子系統**：會計處理
- **備註**：會計科目報表
- **聯絡電話**：7313250

## 2. 檔案架構與關聯圖
### 使用檔案：
- **資料庫檔案**
  - GLAPPF：會計科目主檔
  - GLAHLF01：會計科目主檔
  - GLAHLF10：會計科目主檔
  - GLWF05：會計科目主檔
- **報表檔案**
  - GLA160P：會計科目報表
- **相關程式**
  - GLA1601：報表處理程式
  - GLA1701：報表處理程式
  - P64：報表列印控制程式

## 3. 檔案欄位規格說明
### 變數宣告：
| 變數名稱 | 型態 | 長度 | 說明 |
|---------|------|------|------|
| &DAP01 | 字元 | 2位元 | 科目代號 |
| &DAP02S | 字元 | 8位元 | 科目代號起值 |
| &DAP02E | 字元 | 8位元 | 科目代號迄值 |
| &DAP03S | 字元 | 2位元 | 科目類別起值 |
| &DAP03E | 字元 | 2位元 | 科目類別迄值 |
| &DAP06F | 字元 | 8位元 | 科目代號起值 |
| &DOP | 字元 | 1位元 | 操作代號 |
| &$PENV | 字元 | 1位元 | 執行環境變數 |
| &$CPY | 字元 | 3位元 | 公司代號 |
| &$PRTCD | 字元 | 2位元 | 印表機代號 |
| &P6401I | 字元 | 10位元 | 報表名稱 |
| &P6403I | 數值 | 3位元 | 公司代號 |

## 4. 輸出/入螢幕布局與說明
- 使用GLA160P報表檔案輸出報表
- 報表設定：
  * 頁數：198行
  * 字型：CPI 15

## 5. 處理流程程序說明
### 1. 程式初始化
- 宣告變數
- 讀取LDA資料區的科目範圍：
  * 科目代號：LDA 501-502
  * 科目代號範圍：LDA 523-531
  * 科目類別範圍：LDA 539-541
  * 操作代號：LDA 543

### 2. 主要處理邏輯
1. 建立臨時檔案：
   - 複製GLWF05到QTEMP/GLWF05
   - 處理檔案已存在錯誤（CPF2817）
2. 開啟會計科目主檔並設定共享
3. 建立查詢檔案：
   - 根據多個條件篩選資料：
     * 科目代號
     * 科目代號範圍
     * 科目類別範圍
     * 特殊條件：AP05 = '2'
   - 對應欄位：AP06C = AP06
4. 根據操作代號執行不同處理：
   - 操作代號 = '2'：
     * 開啟GLAHLF10並設定共享
     * 建立查詢檔案（AH01 = DAP01, AH18 = ' '）
     * 呼叫GLA1701和GLA1601
5. 執行報表列印：
   - 設定報表參數
   - 呼叫P64程式控制列印

## 6. 子程序處理邏輯說明
- **GLA1601**：報表處理程式
  * 參數：'1'或'2'
- **GLA1701**：報表處理程式
- **P64**：報表列印控制程式
  * 參數：報表名稱、執行環境、公司代號、印表機代號

## 7. 錯誤處理程序說明與訊息清冊
- 處理CPF2817錯誤（檔案已存在）：
  * 清除檔案內容後繼續執行

## 8. 備註
- 程式使用LDA資料區儲存科目範圍參數
- 支援多個條件的資料篩選
- 使用臨時檔案進行資料處理
- 提供兩種執行模式（根據操作代號）
- 最後會回收系統資源（RCLRSC） 