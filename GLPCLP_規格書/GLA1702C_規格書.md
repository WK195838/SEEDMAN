# 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLA1702C
- **程式說明**：會計系統檔案鎖定控制程式
- **程式語言**：CLP
- **程式位置**：QCLSRC_GLPLIB/GLA1702C
- **開發人員**：DEREK
- **建立日期**：2024.04.12
- **系統名稱**：會計系統
- **子系統**：會計處理
- **備註**：檔案鎖定控制
- **聯絡電話**：7313250
- **需求編號**：1130108

## 2. 檔案架構與關聯圖
### 使用檔案：
- **資料庫檔案**
  - GLAHPF：會計科目主檔

## 3. 檔案欄位規格說明
### 變數宣告：
| 變數名稱 | 型態 | 長度 | 說明 |
|---------|------|------|------|
| &LCK | 字元 | 1位元 | 鎖定控制代號 |
| &IN96 | 邏輯 | 1位元 | 鎖定狀態指示 |

## 4. 輸出/入螢幕布局與說明
- 無螢幕輸出

## 5. 處理流程程序說明
### 1. 程式初始化
- 宣告變數
- 接收參數：
  * &LCK：鎖定控制代號
  * &IN96：鎖定狀態指示

### 2. 主要處理邏輯
1. 鎖定控制（&LCK = '1'）：
   - 嘗試獨佔鎖定GLAHPF檔案
   - 設定等待時間為0
   - 處理鎖定失敗情況：
     * 設定&IN96為'1'
     * 跳轉到釋放物件程序

2. 釋放控制（&LCK ≠ '1'）：
   - 釋放GLAHPF檔案的獨佔鎖定

## 6. 子程序處理邏輯說明
- 無子程序

## 7. 錯誤處理程序說明與訊息清冊
- 處理CPF1002錯誤（物件已被鎖定）：
  * 設定&IN96為'1'
  * 執行釋放物件程序

## 8. 備註
- 程式主要用於控制GLAHPF檔案的鎖定狀態
- 提供兩種操作模式：
  * 鎖定模式（&LCK = '1'）
  * 釋放模式（&LCK ≠ '1'）
- 使用ALCOBJ和DLCOBJ命令進行檔案鎖定控制
- 鎖定失敗時會自動處理並釋放資源
- 更新記錄：
  * 2024/04/12 DEREK：新增LOCK GLAHPF和RELEASE GLAHPF功能 