# 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLR1J01C
- **程式說明**：會計系統會計科目報表執行程式
- **程式語言**：CLP
- **程式位置**：QCLSRC_GLPLIB/GLR1J01C
- **開發人員**：A1150
- **建立日期**：81/11/18
- **系統名稱**：會計系統
- **子系統**：會計處理
- **備註**：會計科目報表執行
- **聯絡電話**：7313250

## 2. 檔案架構與關聯圖
### 使用檔案：
- **資料庫檔案**
  - GLAHPF：會計科目主檔
  - GAWF01：會計科目工作檔
- **相關程式**
  - GLR1J01：報表產生程式
  - P64：報表列印控制程式

## 3. 檔案欄位規格說明
### 變數宣告：
| 變數名稱 | 型態 | 長度 | 說明 |
|---------|------|------|------|
| &DAH01 | 字元 | 2位元 | 科目代號 |
| &DAH25F | 字元 | 8位元 | 起始日期 |
| &DAH25T | 字元 | 8位元 | 結束日期 |
| &DAH10F | 字元 | 8位元 | 起始日期 |
| &DAH10T | 字元 | 8位元 | 結束日期 |
| &DAH02F | 字元 | 9位元 | 起始科目代號 |
| &DAH02T | 字元 | 9位元 | 結束科目代號 |
| &DAH26F | 字元 | 10位元 | 起始科目名稱 |
| &DAH26T | 字元 | 10位元 | 結束科目名稱 |
| &DAH17F | 字元 | 2位元 | 起始科目類別 |
| &DAH17T | 字元 | 2位元 | 結束科目類別 |
| &$PENV | 字元 | 1位元 | 環境變數 |
| &$CPY | 字元 | 3位元 | 公司代號 |
| &$PRTCD | 字元 | 2位元 | 列印代號 |
| &P6401I | 字元 | 10位元 | 報表名稱 |
| &P6403I | 數值 | 3位元 | 公司代號 |

## 4. 輸出/入螢幕布局與說明
- 無螢幕輸出
- 使用報表檔案：GLR1J0P
- 報表格式：
  * 頁面大小：33行 x 198列
  * 字體大小：15 CPI
  * 溢位行數：30行
  * 報表標題：會計科目報表

## 5. 處理流程程序說明
### 1. 程式初始化
- 宣告變數
- 從LDA資料區讀取參數：
  * 科目代號（LDA 501-502）
  * 日期範圍（LDA 503-527）
  * 科目代號範圍（LDA 535-544）
  * 科目名稱範圍（LDA 553-563）
  * 科目類別範圍（LDA 573-575）

### 2. 主要處理邏輯
1. 資料庫檔案處理：
   - 覆蓋資料庫檔案（GAWF01）指向GLAHPF並設定為共享模式
   - 建立查詢檔案，條件包含：
     * 科目代號（WF0101）
     * 日期範圍（WF0125）
     * 日期範圍（WF0110）
     * 科目代號範圍（WF0102）
     * 科目名稱範圍（AH26）
     * 科目類別範圍（AH17）
   - 查詢檔案索引欄位：
     * WF0101（科目代號）
     * WF0102（科目代號）
     * WF0103（科目代號）
   - 欄位對應關係：
     * WF0101 -> AH01
     * WF0102 -> AH02
     * WF0103 -> AH03
     * WF0104 -> AH04
     * WF0105 -> AH05
     * WF0106 -> AH06
     * WF0107 -> AH07
     * WF0108 -> AH08
     * WF0109 -> AH09
     * WF0110 -> AH10
     * WF0112 -> AH12
     * WF0113 -> AH13
     * WF0115 -> AH15
     * WF0116 -> AH16
     * WF0125 -> AH25
     * WF0126 -> AH26

2. 報表產生與列印：
   - 設定報表格式（GLR1J0P）
   - 呼叫GLR1J01產生報表
   - 關閉查詢檔案
   - 刪除覆蓋設定

3. 報表列印控制：
   - 讀取系統參數：
     * 環境設定（LDA 219）
     * 公司代號（LDA 125-127）
     * 列印代號（LDA 217-218）
   - 呼叫P64程式進行報表列印

## 6. 子程序處理邏輯說明
- **GLR1J01**：報表產生程式
  * 負責實際報表內容的產生
  * 使用查詢檔案（GLAHPF）的資料

- **P64**：報表列印控制程式
  * 控制報表的實際列印
  * 參數：
    - 報表名稱（&P6401I）
    - 環境設定（&$PENV）
    - 公司代號（&P6403I）
    - 列印代號（&$PRTCD）

## 7. 錯誤處理程序說明與訊息清冊
- 查詢檔案建立失敗時會影響報表產生
- 報表列印失敗時會影響實際輸出

## 8. 備註
- 程式主要用於執行會計科目報表的產生和列印
- 支援多種查詢條件組合
- 使用LDA資料區傳遞參數
- 程式結構包含：
  * 參數讀取
  * 資料查詢
  * 報表產生
  * 報表列印 