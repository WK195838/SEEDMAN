*---------------------------------------------------------------*
*  程式名稱：PCR042S  資料彙總程式 (RPGII)
*---------------------------------------------------------------*
*  變數定義
*---------------------------------------------------------------*
C     QTR         DS      1 0      * 季度代碼(1-4)
C     YEAR        DS      4 0      * 年度
C     QTR_TOTAL   DS     15 2      * 季度合計金額
C     QTR_PREV    DS     15 2      * 上季金額
C     QTR_YTD     DS     15 2      * 年度累計金額
C     ACCT_NO     DS      9        * 科目代碼
C     ACCT_NAME   DS     41        * 科目名稱
C     ACCT_LEVEL  DS      1 0      * 科目級別
C     ACCT_TOTAL  DS     15 2      * 科目合計金額
C     ACCT_PREV   DS     15 2      * 科目上季金額
C     ACCT_YTD    DS     15 2      * 科目年度累計
C     WORK_AREA   DS    100        * 工作區
*---------------------------------------------------------------*
*  檔案定義
*---------------------------------------------------------------*
C     GLAAPF     E                   DISK    * 會計科目主檔
C     GLAFPF     E                   DISK    * 會計分錄主檔
C     GLR2D0P2   E                   DISK    * 報表格式檔
*---------------------------------------------------------------*
*  參數接收
*---------------------------------------------------------------*
C     *ENTRY    PLIST
C               PARM    QTR
C               PARM    YEAR
C               PARM    QTR_TOTAL
C               PARM    QTR_PREV
C               PARM    QTR_YTD
*---------------------------------------------------------------*
*  初始化工作區
*---------------------------------------------------------------*
C               Z-ADD   0        ACCT_TOTAL
C               Z-ADD   0        ACCT_PREV
C               Z-ADD   0        ACCT_YTD
*---------------------------------------------------------------*
*  讀取會計科目主檔
*---------------------------------------------------------------*
C     GLAAPF    CHAIN   ACCT_NO
C               IF      %FOUND
C               MOVE    ACCT_NAME ACCT_NAME
C               MOVE    ACCT_LEVEL ACCT_LEVEL
*---------------------------------------------------------------*
*  計算科目金額
*---------------------------------------------------------------*
C               CHAIN   (YEAR:QTR) GLAFPF
C               IF      %FOUND
C               ADD     AMOUNT    ACCT_TOTAL
C               IF      COMP_OPT = 'Y'
C               ADD     PREV_AMT  ACCT_PREV
C               ENDIF
C               IF      YTD_OPT = 'Y'
C               ADD     YTD_AMT   ACCT_YTD
C               ENDIF
C               ENDIF
*---------------------------------------------------------------*
*  更新報表格式檔
*---------------------------------------------------------------*
C               CHAIN   ACCT_NO GLR2D0P2
C               IF      %FOUND
C               UPDATE  GLR2D0P2R
C               ENDIF
C               ENDIF
*---------------------------------------------------------------*
*  計算各級科目合計
*---------------------------------------------------------------*
C     ACCT_LEVEL IFEQ    1
C               ADD     ACCT_TOTAL QTR_TOTAL
C               IF      COMP_OPT = 'Y'
C               ADD     ACCT_PREV  QTR_PREV
C               ENDIF
C               IF      YTD_OPT = 'Y'
C               ADD     ACCT_YTD   QTR_YTD
C               ENDIF
C               ENDIF
*---------------------------------------------------------------*
*  更新報表合計
*---------------------------------------------------------------*
C               CHAIN   'TOTAL' GLR2D0P2
C               IF      %FOUND
C               UPDATE  GLR2D0P2R
C               ENDIF
*---------------------------------------------------------------*
C               SETON   LR
*---------------------------------------------------------------* 