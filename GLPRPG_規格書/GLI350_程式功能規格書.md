# GLI350 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLI350
- **程式說明**：報表格式設定資料查詢
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLI350
- **開發人員**：A1149 MAY
- **建立日期**：1992.10.29
- **更新日期**：-
- **系統**：會計總帳
- **功能描述**：提供報表格式設定資料的查詢功能，可依照公司代碼、報表類別及報表代碼查詢相關設定資料

## 2. 檔案架構與關聯圖
此程式使用以下檔案：

### 檔案清單
- **GLARPF**：報表格式設定檔（讀取檔案）
- **GLI350D**：螢幕顯示檔（工作站檔案）

### 檔案間關聯
- 使用公司代碼（DAR01）、報表類別（DAR02）及報表代碼（DAR03）連結GLARPF取得報表格式設定資料
- 使用KEYAR、KEYARR關鍵字列表進行檔案存取

## 3. 檔案欄位規格說明

### GLARPF (報表格式設定檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AR01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AR02 | 報表類別 | - | 2 | 文字 | 主鍵 |
| AR03 | 報表代碼 | - | 3 | 文字 | 主鍵 |
| AR04 | 報表名稱 | - | - | 文字 | 報表名稱 |
| AR05 | 報表方向 | - | 1 | 文字 | 1=直印，其他=橫印 |
| AR06 | 備註說明 | - | - | 文字 | 備註說明 |

### 程式參數區域
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| $USER | 使用者代碼 | 101 | 10 | 文字 | 目前使用者代碼 |
| $USERN | 使用者姓名 | 152 | 10 | 文字 | 目前使用者姓名 |
| $A8YMD | 系統日期 | 201 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $C8YMD | 系統日期 | 209 | 8 | 數值 | 系統日期(YYYYMMDD) |
| DAR01 | 公司代碼 | - | 2 | 文字 | 查詢的公司代碼 |
| DAR02 | 報表類別 | - | 2 | 文字 | 查詢的報表類別 |
| DAR03 | 報表代碼 | - | 3 | 文字 | 查詢的報表代碼 |
| P350I1 | 公司代碼 | - | 2 | 文字 | 輸入參數-公司代碼 |
| P350I2 | 報表類別 | - | 2 | 文字 | 輸入參數-報表類別 |
| P350I3 | 報表代碼 | - | 3 | 文字 | 輸入參數-報表代碼 |
| @RTNC | 返回代碼 | - | 2 | 文字 | 返回代碼 |

## 4. 輸出/入螢幕布局與說明

### 查詢結果畫面
```
                             報表格式設定資料查詢                           公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        

選項 報表類別 報表代碼   報表名稱                 報表方向   備註說明
 _   XX      XXX      XXXXXXXXXXXXXXXXXXXX     直印      XXXXXXXXXXXXXXXXXXXX
 _   XX      XXX      XXXXXXXXXXXXXXXXXXXX     橫印      XXXXXXXXXXXXXXXXXXXX
 _   XX      XXX      XXXXXXXXXXXXXXXXXXXX     直印      XXXXXXXXXXXXXXXXXXXX
 _   XX      XXX      XXXXXXXXXXXXXXXXXXXX     橫印      XXXXXXXXXXXXXXXXXXXX
 _   XX      XXX      XXXXXXXXXXXXXXXXXXXX     直印      XXXXXXXXXXXXXXXXXXXX

F3=結束  F12=返回  ROLL UP=下一頁
```

### 功能鍵說明
- F3：結束
- F12：返回
- ROLL UP：下一頁

## 5. 處理流程程序說明

### 主要處理流程
1. 初始化程式環境（R0100子程序）
   - 讀取系統參數
   - 設定初始值
   - 初始化子檔

2. 處理螢幕輸入（R1000子程序）
   - 顯示螢幕
   - 處理功能鍵
   - 處理選項

3. 讀取報表格式資料（R1A10子程序）
   - 讀取報表格式設定檔
   - 顯示報表格式資料
   - 處理翻頁

## 6. 子程序處理邏輯說明

### R0100 - 初始化處理
- 讀取PTDA01資料區
- 呼叫P31程式取得系統日期
- 設定頁面大小
- 呼叫R1A00初始化子檔

### R1000 - 螢幕處理
- 顯示主畫面
- 處理功能鍵輸入
- 處理翻頁
- 呼叫R1C00處理選項

### R1A00 - 子檔初始化
- 初始化子檔變數
- 清除子檔
- 設定子檔控制指標
- 設定讀取位置
- 呼叫R1A10讀取報表格式資料
- 處理無資料情況

### R1A10 - 讀取報表格式資料
- 設定讀取位置
- 讀取報表格式設定檔
- 呼叫R1A11寫入子檔

### R1A11 - 寫入子檔資料
- 格式化報表方向顯示（直印/橫印）
- 寫入子檔記錄

### R1A20 - 子檔標題設定
- 設定子檔標題資料

### R1C00 - 處理選項
- 讀取子檔選項
- 設定返回參數
- 設定返回代碼
- 更新子檔

### R1N00 - 處理翻頁
- 檢查是否已到最後一頁
- 呼叫R1A10讀取更多資料

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤處理
- 當找不到符合條件的記錄時，會顯示無資料訊息

### 訊息清冊
| 訊息代碼 | 說明 | 處理方式 |
|---------|------|---------|
| UPT2050 | 無符合條件的資料 | 顯示錯誤訊息 |

## 8. 備註
- 本程式為報表格式設定資料查詢功能，提供使用者查詢特定條件的報表格式設定資料
- 程式可被其他程式呼叫，用於查詢報表格式設定資料
- 程式支援翻頁功能，可以查看更多符合條件的資料
- 程式會返回使用者選擇的報表格式設定資料，供呼叫程式使用
- 返回代碼說明：
  - '00'：使用者選擇了一筆資料
  - '03'：使用者按了F3結束鍵
  - '12'：使用者按了F12返回鍵 