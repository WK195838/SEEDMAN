*---------------------------------------------------------------*
*  程式名稱：PCR042E  錯誤處理程式 (RPGII)
*---------------------------------------------------------------*
*  變數定義
*---------------------------------------------------------------*
C     ERROR_CODE  DS      5 0      * 錯誤代碼
C     ERROR_MSG   DS     80        * 錯誤訊息
C     ERROR_DATA  DS    100        * 錯誤資料
C     ERR_DATE    DS      8        * 錯誤日期
C     ERR_TIME    DS      8        * 錯誤時間
C     ERR_USER    DS     10        * 錯誤使用者
C     ERR_PROG    DS     10        * 錯誤程式
C     ERR_MODULE  DS     10        * 錯誤模組
C     WORK_AREA   DS    100        * 工作區
*---------------------------------------------------------------*
*  檔案定義
*---------------------------------------------------------------*
C     ERROR_LOG   E                   DISK    * 錯誤記錄檔
*---------------------------------------------------------------*
*  參數接收
*---------------------------------------------------------------*
C     *ENTRY    PLIST
C               PARM    ERROR_CODE
C               PARM    ERROR_MSG
C               PARM    ERROR_DATA
*---------------------------------------------------------------*
*  取得系統日期時間
*---------------------------------------------------------------*
C               TIME                    ERR_TIME
C               DATE                    ERR_DATE
*---------------------------------------------------------------*
*  取得使用者資訊
*---------------------------------------------------------------*
C               MOVE    %USER     ERR_USER
C               MOVE    'PCR042'  ERR_PROG
C               MOVE    'ERROR'   ERR_MODULE
*---------------------------------------------------------------*
*  錯誤訊息處理
*---------------------------------------------------------------*
C     ERROR_CODE IFEQ    1001
C               MOVE    '參數驗證錯誤' ERROR_MSG
C     ERROR_CODE ELSEIF  1002
C               MOVE    '資料讀取錯誤' ERROR_MSG
C     ERROR_CODE ELSEIF  1003
C               MOVE    '資料彙總錯誤' ERROR_MSG
C     ERROR_CODE ELSEIF  1004
C               MOVE    '報表產生錯誤' ERROR_MSG
C               ENDIF
*---------------------------------------------------------------*
*  記錄錯誤訊息
*---------------------------------------------------------------*
C               CHAIN   ERROR_CODE ERROR_LOG
C               IF      %FOUND
C               UPDATE  ERROR_LOGR
C               ELSE
C               WRITE   ERROR_LOGR
C               ENDIF
*---------------------------------------------------------------*
*  顯示錯誤訊息
*---------------------------------------------------------------*
C               EXFMT   ERROR_MSG
*---------------------------------------------------------------*
*  錯誤回復處理
*---------------------------------------------------------------*
C     ERROR_CODE IFEQ    1001
C               GOTO    PARM_ERR
C     ERROR_CODE ELSEIF  1002
C               GOTO    READ_ERR
C     ERROR_CODE ELSEIF  1003
C               GOTO    CALC_ERR
C     ERROR_CODE ELSEIF  1004
C               GOTO    RPT_ERR
C               ENDIF
*---------------------------------------------------------------*
*  錯誤回復標籤
*---------------------------------------------------------------*
PARM_ERR   TAG
C               MOVE    ' '      ERROR_MSG
C               GOTO    END_PGM
READ_ERR   TAG
C               MOVE    ' '      ERROR_MSG
C               GOTO    END_PGM
CALC_ERR   TAG
C               MOVE    ' '      ERROR_MSG
C               GOTO    END_PGM
RPT_ERR    TAG
C               MOVE    ' '      ERROR_MSG
C               GOTO    END_PGM
END_PGM    TAG
C               SETON   LR
*---------------------------------------------------------------* 