# GLA180 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLA180
- **程式說明**：結帳處理設定
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLA180
- **開發人員**：A1150
- **建立日期**：81/11/03
- **修改日期**：
- **系統**：總帳系統

## 2. 檔案架構與關聯圖

### 使用檔案
- **GLAKPF**：總帳基本檔案
- **GLA180D**：螢幕顯示檔案

### 程式關係
- **主程式**：GLA180
- **呼叫程式**：
  - P31：日期格式處理程式
- **功能鍵**：F3(離開), F5(顯示結帳設定)

## 3. 檔案欄位規格說明

### 資料結構定義
- **PTDA01**
  - $PFMT (1-1)：參數格式
  - $PTYPE (2-2)：參數類型

- **UDS (使用者資料區)**
  - $USER (101-110)：使用者代碼
  - $USERN (152-161)：使用者名稱
  - $C8YMD (209-216)：日期
  - $A8YMD (201-208)：日期

- **鍵值列表**
  - KEYAK：公司別索引鍵
  
- **工作變數**
  - DAK01：公司別
  - DAK15：結帳標記
  - ERRID：錯誤訊息代碼
  - ERRF：錯誤訊息檔案

## 4. 輸出/入螢幕布局與說明

### 主要螢幕 (GLA180D)
- **螢幕標題**：結帳處理設定
- **輸入欄位**：
  - 公司別 (DAK01)：必填
  - 結帳標記 (DAK15)：可設定為'Y'表示禁止該公司再進行結帳作業

- **功能鍵**：
  - F3：返回主畫面
  - F5：顯示結帳設定
  - ENTER：確認更新

## 5. 處理流程程序說明

### 主要流程
1. 初始化程式環境和畫面 (R0100)
2. 顯示主畫面 (R1000)
3. 處理使用者輸入
   - 若按F3：結束程式
   - 若按F5：顯示公司結帳設定狀態
   - 若按ENTER：檢查輸入資料 (R1B00)並更新資料 (R2B00)

### 程式初始化流程 (R0100)
1. 讀取參數資料區
2. 呼叫P31設定日期格式
3. 初始化公司別和結帳標記欄位為空白

## 6. 子程序處理邏輯說明

### 螢幕處理 (R1000)
- 顯示主畫面並等待使用者輸入
- 處理功能鍵及輸入資料
- 根據不同功能鍵執行對應處理
- 若按F5，讀取公司的結帳設定狀態並顯示
- 若無錯誤，則執行資料更新

### 資料檢核 (R1B00)
1. 檢查必填欄位公司別 (DAK01)
2. 檢查公司別是否存在於總帳基本檔案中
3. 若任一檢核失敗，設定錯誤指示燈並返回主畫面

### 資料更新 (R2B00)
1. 根據畫面輸入設定結帳標記
   - 若DAK15為'Y'，設定AK15為'Y'(禁止結帳)
   - 若DAK15為空白，設定AK15為空白(允許結帳)
2. 更新GLAKPF檔案
3. 顯示更新完成訊息

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤訊息
- **UPT0010**：必填欄位未輸入 (公司別) (欄位61)
- **UPT2010**：公司別不存在 (欄位61)
- **UPT2075**：資料已更新

### 錯誤處理
- 設定對應的錯誤指示燈
- 返回主畫面並顯示錯誤訊息
- 將游標定位在錯誤欄位

## 8. 備註

本程式用於設定特定公司的結帳控制，主要功能包括：

1. 提供介面讓管理員設定特定公司是否禁止進行結帳作業
2. 若將結帳標記設為"Y"，則該公司將無法執行結帳作業
3. 設定結果直接更新到總帳基本檔案(GLAKPF)中的AK15欄位
4. 此設定可被用來在特定時間限制結帳操作，例如在系統維護期間或年度關帳前

這個程式是總帳系統管理功能的一部分，通常只有具備管理權限的用戶才能執行，用於控制結帳流程和避免不當的結帳操作。 