# 程式功能規格書

## 1. 基本資料
- **程式名稱**：GAR3041
- **程式說明**：會計系統報表產生程式
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GAR3041
- **開發者**：MERCURY
- **建立日期**：83/03/03
- **系統名稱**：會計系統
- **子系統**：會計處理
- **備註**：會計科目報表程式
- **聯絡電話**：5042266

## 2. 檔案架構與關聯圖
### 使用檔案：
- **資料庫檔案**
  - GLARPF：會計工作檔（輸入模式）
  - GLASLF01：會計明細檔（輸入模式）
  - PT#BPF：批次檔（輸入模式）
  - #FRCDF：系統代號檔（輸入模式）
- **輸出檔案**
  - GAR304P：報表輸出檔

## 3. 檔案欄位規格說明
### 資料區定義：
| 欄位名稱 | 位置 | 長度 | 型態 | 說明 |
|---------|------|------|------|------|
| $USER | 101-110 | 10 | 字元 | 使用者代號 |
| $EGMDY | 119-124 | 6 | 數值 | 系統日期 |
| $EVR | 162 | 1 | 字元 | 環境變數 |
| $CPY | 125-127 | 3 | 數值 | 公司代號 |
| $WRHUS | 501-505 | 5 | 字元 | 倉庫代號 |
| $PRTID | 598-599 | 2 | 字元 | 列印代號 |
| DAR01S | 601-602 | 2 | 字元 | 會計科目起號 |
| DAR01E | 603-604 | 2 | 字元 | 會計科目迄號 |
| DAR02S | 605-606 | 2 | 字元 | 會計期間起號 |
| DAR02E | 607-608 | 2 | 字元 | 會計期間迄號 |
| DAR03S | 609-611 | 3 | 字元 | 部門代號起號 |
| DAR03E | 612-614 | 3 | 字元 | 部門代號迄號 |

## 4. 輸出/入螢幕布局與說明
- 使用報表輸出檔：GAR304P
- 報表功能：
  * 報表標題
  * 報表內容
  * 報表小計
  * 報表總計
- 層級控制：
  * 層級1：會計科目（AR03）
  * 層級2：會計期間（AR02）
  * 層級2：部門代號（AR01）

## 5. 處理流程程序說明
### 1. 程式初始化
- 初始化處理（RTN010）：
  * 清空描述欄位
  * 讀取部門代號資料
  * 讀取批次檔資料
  * 設定報表標題
  * 設定初始化完成標記

### 2. 主要處理邏輯
1. 資料處理（RTN100）：
   - 讀取會計工作檔資料
   - 讀取會計明細檔資料
   - 處理正負號顯示
   - 輸出明細資料
   - 控制分頁處理
   - 處理層級控制

2. 分頁處理（RTN900）：
   - 輸出分頁標題
   - 重置分頁控制
   - 重置狀態控制

3. 結束處理（RTN990）：
   - 輸出報表結束
   - 處理無資料情況

## 6. 子程序處理邏輯說明
- 無子程序呼叫

## 7. 錯誤處理程序說明與訊息清冊
- 資料讀取錯誤：
  * 會計工作檔讀取失敗
  * 會計明細檔讀取失敗
  * 批次檔讀取失敗
  * 系統代號檔讀取失敗
- 報表輸出錯誤：
  * 報表標題輸出失敗
  * 明細資料輸出失敗
  * 總計資料輸出失敗

## 8. 備註
- 程式主要用於產生會計科目報表
- 報表處理特點：
  * 支援多層級資料處理（會計科目、會計期間、部門代號）
  * 支援正負號顯示處理
  * 支援分頁控制
  * 使用多個資料庫檔案
- 處理邏輯：
  * 先進行初始化
  * 再處理資料讀取和輸出
  * 最後處理分頁和結束 