# GLI1L0 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLI1L0
- **程式說明**：會計科目餘額查詢
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLI1L0
- **開發人員**：A1152 ANGY
- **建立日期**：1992.11.04
- **更新日期**：1994.06.23
- **系統**：會計總帳
- **功能描述**：提供會計科目餘額查詢功能，可依照不同條件查詢科目餘額資料

## 2. 檔案架構與關聯圖
此程式使用以下檔案：

### 檔案清單
- **PT#BPF**：系統參數檔（讀取檔案）
- **GLAFPF**：會計科目檔（讀取檔案）
- **GLAAPF**：會計參數檔（讀取檔案）
- **GLAKPF**：會計期間檔（讀取檔案）
- **GLAHLF03**：會計分錄歷史檔（讀取檔案）
- **GLAILF01**：科目餘額檔（讀取檔案）
- **GLI1L0D**：螢幕顯示檔（工作站檔案）

### 檔案間關聯
- 使用公司代碼（DAH01）連結各檔案
- 使用公司代碼、科目代碼（DAH01、DAH04）連結GLAFPF取得科目資料
- 使用公司代碼、科目代碼、日期（DAH01、DAH04、#AH10）連結GLAHLF03取得分錄資料
- 使用公司代碼、科目代碼、日期（WAI01、WAI02、WAI03）連結GLAILF01取得餘額資料
- 使用KEYAH3、KEYAH1、KEYAHR、KEYAI、KEYAF、KEY#B、KEYAA等關鍵字列表進行檔案存取

## 3. 檔案欄位規格說明

### GLAHLF03 (會計分錄歷史檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AH01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AH02 | 分錄編號 | - | 10 | 文字 | 分錄編號 |
| AH04 | 科目代碼 | - | 8 | 文字 | 科目代碼 |
| AH05 | 部門代碼1 | - | 20 | 文字 | 部門代碼1 |
| AH06 | 部門代碼2 | - | 20 | 文字 | 部門代碼2 |
| AH07 | 部門代碼3 | - | 20 | 文字 | 部門代碼3 |
| AH08 | 部門代碼4 | - | 20 | 文字 | 部門代碼4 |
| AH09 | 數量 | - | - | 數值 | 數量 |
| AH10 | 交易日期 | - | 8 | 數值 | 會計交易日期 |
| AH12 | 借方金額 | - | - | 數值 | 借方金額 |
| AH13 | 貸方金額 | - | - | 數值 | 貸方金額 |
| AH18 | 過帳標記 | - | 1 | 文字 | V=已過帳，空白=未過帳 |
| AH19 | 結案標記 | - | 1 | 文字 | V=已結案，空白=未結案 |
| AH20 | 作廢標記 | - | 1 | 文字 | V=已作廢，空白=未作廢 |

### GLAFPF (會計科目檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AF01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AF02 | 科目代碼 | - | 8 | 文字 | 主鍵 |
| AF03 | 科目名稱 | - | - | 文字 | 科目名稱 |
| AF06 | 科目性質 | - | 1 | 文字 | 1=借方，2=貸方 |
| AF07 | 匯率 | - | - | 數值 | 匯率 |
| AF08 | 使用標記 | - | 1 | 文字 | 1=使用中 |
| AF11 | 部門代碼1檢核 | - | 1 | 文字 | 是否檢核部門代碼1 |
| AF12 | 部門代碼2檢核 | - | 1 | 文字 | 是否檢核部門代碼2 |
| AF13 | 部門代碼3檢核 | - | 1 | 文字 | 是否檢核部門代碼3 |
| AF14 | 部門代碼4檢核 | - | 1 | 文字 | 是否檢核部門代碼4 |
| AF15 | 數量檢核 | - | 1 | 文字 | 是否檢核數量 |
| AF18 | 部門代碼檢核 | - | 7 | 文字 | 部門代碼檢核設定 |

### GLAILF01 (科目餘額檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AI01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AI02 | 期別 | - | 40 | 數值 | 主鍵，期別 |
| AI03 | 科目代碼 | - | 8 | 文字 | 主鍵，科目代碼 |
| AI04 | 部門代碼1 | - | 20 | 文字 | 部門代碼1 |
| AI05 | 部門代碼2 | - | 20 | 文字 | 部門代碼2 |
| AI06 | 部門代碼3 | - | 20 | 文字 | 部門代碼3 |
| AI07 | 部門代碼4 | - | 20 | 文字 | 部門代碼4 |
| AI08 | 數量 | - | - | 數值 | 數量 |
| AI10 | 期初餘額 | - | - | 數值 | 期初餘額 |
| AI11-AI23 | 各月餘額 | - | - | 數值 | 1-13月餘額 |

### GLAKPF (會計期間檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AK01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AK09 | 日期格式 | - | 1 | 文字 | 日期格式 |
| AK10 | 會計年度 | - | 1 | 文字 | 會計年度型態 |
| AK11 | 日期分隔符號 | - | 1 | 文字 | 日期分隔符號 |

### GLAAPF (會計參數檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AA01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AA02 | 部門代碼 | - | 2 | 文字 | 主鍵 |
| AA03 | 部門名稱 | - | 20 | 文字 | 部門名稱 |
| AA04 | 檢核程式 | - | 10 | 文字 | 檢核程式名稱 |
| AA05 | 參數名稱 | - | 10 | 文字 | 參數名稱 |

### PT#BPF (系統參數檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #B01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| #B02 | 公司名稱 | - | - | 文字 | 公司名稱 |

### 程式參數區域
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| $USER | 使用者代碼 | 101 | 10 | 文字 | 目前使用者代碼 |
| $USERN | 使用者姓名 | 152 | 10 | 文字 | 目前使用者姓名 |
| $A8YMD | 系統日期 | 201 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $C8YMD | 系統日期 | 209 | 8 | 數值 | 系統日期(YYYYMMDD) |
| DAH01 | 公司代碼 | - | 2 | 文字 | 查詢的公司代碼 |
| DAH04 | 科目代碼 | - | 8 | 文字 | 查詢的科目代碼 |
| DAH05-DAH08 | 部門代碼1-4 | - | 20 | 文字 | 查詢的部門代碼 |
| DAH09 | 數量 | - | - | 數值 | 查詢的數量 |
| DAH10 | 交易日期 | - | 8 | 數值 | 查詢的交易日期 |
| #AH10 | 交易日期 | - | 8 | 數值 | 格式化後的交易日期 |
| W02 | 部門代碼檢核 | - | 5 | 文字 | 部門代碼檢核設定 |
| W03 | 部門名稱 | - | 5 | 文字 | 部門名稱 |
| W04 | 檢核程式名稱 | - | 5 | 文字 | 檢核程式名稱 |
| W05 | 部門代碼內容 | - | 4 | 文字 | 部門代碼內容 |
| W07 | 部門代碼檢核 | - | 7 | 文字 | 部門代碼檢核設定 |
| W09 | 參數名稱 | - | 7 | 文字 | 參數名稱 |

## 4. 輸出/入螢幕布局與說明

### 主畫面 (SC01)
```
                             會計科目餘額查詢                               公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX
科目代碼：XXXXXXXX  科目名稱：XXXXXXXXXXXXXXXXXXXX

F3=結束  F4=提示
```

### 條件畫面 (SC02)
```
                             會計科目餘額查詢                               公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX
科目代碼：XXXXXXXX  科目名稱：XXXXXXXXXXXXXXXXXXXX

交易日期：YYYY/MM/DD

部門代碼1：XXXXXXXXXXXXXXXXXXXX
部門代碼2：XXXXXXXXXXXXXXXXXXXX
部門代碼3：XXXXXXXXXXXXXXXXXXXX
部門代碼4：XXXXXXXXXXXXXXXXXXXX
數量：XXXXXX

F3=結束  F4=提示  F12=返回
```

### 查詢結果畫面 (SC03)
```
                             會計科目餘額查詢                               公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX
科目代碼：XXXXXXXX  科目名稱：XXXXXXXXXXXXXXXXXXXX

選項 分錄編號     交易日期   借方金額          貸方金額          狀態
 _   XXXXXXXXXX  YYYY/MM/DD 999,999,999.99   999,999,999.99    XXX
 _   XXXXXXXXXX  YYYY/MM/DD 999,999,999.99   999,999,999.99    XXX
 _   XXXXXXXXXX  YYYY/MM/DD 999,999,999.99   999,999,999.99    XXX
 _   XXXXXXXXXX  YYYY/MM/DD 999,999,999.99   999,999,999.99    XXX
 _   XXXXXXXXXX  YYYY/MM/DD 999,999,999.99   999,999,999.99    XXX

                           ===============   ===============
                           999,999,999.99   999,999,999.99

F3=結束  F12=返回  ROLL UP=下一頁
```

### 功能鍵說明
- F3：結束
- F4：提示
- F12：返回
- ROLL UP：下一頁

### 選項說明
- 5：呼叫GLI1F0程式查看分錄明細

## 5. 處理流程程序說明

### 主要處理流程
1. 初始化程式環境（R0100子程序）
   - 讀取系統參數
   - 設定初始值
   - 初始化螢幕

2. 處理主畫面輸入（R1000子程序）
   - 顯示主畫面
   - 檢核輸入資料
   - 處理功能鍵
   - 轉至條件畫面

3. 處理條件畫面輸入（R2000子程序）
   - 顯示條件畫面
   - 檢核輸入資料
   - 處理功能鍵
   - 轉至查詢結果畫面

4. 處理查詢結果畫面（R3000子程序）
   - 顯示查詢結果
   - 處理功能鍵
   - 處理選項
   - 處理翻頁

## 6. 子程序處理邏輯說明

### R0100 - 初始化處理
- 讀取PTDA01資料區
- 呼叫P31程式取得系統日期
- 初始化公司代碼和科目代碼

### R1000 - 主畫面處理
- 顯示主畫面
- 處理功能鍵輸入
- 呼叫R1B00檢核輸入資料
- 呼叫R1C00初始化第二個畫面

### R1B00 - 主畫面資料檢核
- 檢核公司代碼是否存在
- 檢核科目代碼是否存在
- 檢核科目是否為使用中

### R1C00 - 初始化條件畫面
- 初始化交易日期和部門代碼
- 設定部門代碼檢核設定
- 讀取部門代碼相關資訊

### R1E00 - 主畫面提示處理
- 處理F4提示功能鍵
- 呼叫GLI410程式提示科目代碼

### R2000 - 條件畫面處理
- 顯示條件畫面
- 處理功能鍵輸入
- 呼叫R2B00檢核輸入資料
- 呼叫R2C00初始化查詢結果畫面

### R2B00 - 條件畫面資料檢核
- 檢核交易日期是否有效
- 檢核部門代碼是否有效
- 呼叫相應的檢核程式驗證部門代碼

### R2C00 - 初始化查詢結果畫面
- 呼叫R3A00初始化子檔

### R2E00 - 條件畫面提示處理
- 處理F4提示功能鍵
- 依據游標位置呼叫相應的檢核程式

### R3000 - 查詢結果畫面處理
- 顯示查詢結果畫面
- 處理功能鍵輸入
- 處理翻頁
- 呼叫R3C00處理選項

### R3A00 - 子檔初始化
- 初始化子檔變數
- 清除子檔
- 設定子檔控制指標
- 呼叫R3A20設定子檔標題
- 呼叫R3A10讀取分錄資料
- 處理無資料情況

### R3A10 - 讀取分錄資料
- 設定讀取位置
- 讀取會計分錄歷史檔
- 依據條件過濾資料
- 呼叫R3A11寫入子檔

### R3A11 - 寫入子檔資料
- 格式化交易日期
- 設定分錄狀態標記
- 計算借貸方金額
- 寫入子檔記錄

### R3A20 - 設定子檔標題
- 讀取公司資料
- 讀取科目資料
- 讀取科目餘額資料
- 計算期初餘額和各月餘額
- 計算總餘額

### R3C00 - 處理選項
- 讀取子檔選項
- 處理選項5（呼叫GLI1F0程式查看分錄明細）
- 更新子檔

### R3N00 - 處理翻頁
- 檢查是否已到最後一頁
- 呼叫R3A10讀取更多資料

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤處理
- 當輸入資料有誤時，會顯示相應的錯誤訊息
- 當找不到符合條件的記錄時，會顯示無資料訊息

### 訊息清冊
| 訊息代碼 | 說明 | 處理方式 |
|---------|------|---------|
| UPT0010 | 必須輸入資料 | 顯示錯誤訊息 |
| UPT0012 | 數量必須輸入 | 顯示錯誤訊息 |
| UPT0030 | 資料不存在 | 顯示錯誤訊息 |
| UPT0040 | 日期格式錯誤 | 顯示錯誤訊息 |
| UPT2010 | 公司代碼不存在 | 顯示錯誤訊息 |
| UPT2050 | 無符合條件的資料 | 顯示錯誤訊息 |
| UGL0009 | 科目不在使用中 | 顯示錯誤訊息 |
| CPF5203 | 已到檔案結尾 | 顯示錯誤訊息 |

## 8. 備註
- 本程式為會計科目餘額查詢功能，提供使用者查詢特定科目的餘額資料
- 程式支援多種查詢條件，包括公司代碼、科目代碼、交易日期、部門代碼和數量
- 程式會依據科目性質（借方或貸方）計算餘額
- 程式會顯示分錄的狀態標記，包括過帳標記、結案標記、作廢標記
- 程式會計算借貸方金額合計，並顯示在畫面底部
- 使用者可以選擇特定分錄，程式會呼叫GLI1F0程式查看分錄詳細資料
- 程式支援翻頁功能，可以查看更多符合條件的資料
- 程式會依據部門代碼檢核設定檢核部門代碼的有效性 