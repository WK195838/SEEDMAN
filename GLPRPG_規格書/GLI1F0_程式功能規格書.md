# GLI1F0 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLI1F0
- **程式說明**：分錄查詢
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLI1F0
- **開發人員**：A1152 ANGY
- **建立日期**：1992.11.04
- **更新日期**：1994.06.23
- **系統**：會計總帳
- **功能描述**：提供會計分錄詳細資料的查詢功能，顯示分錄的完整資訊

## 2. 檔案架構與關聯圖
此程式使用以下檔案：

### 檔案清單
- **GLAHLF01**：會計分錄歷史檔（讀取檔案）
- **GLAKPF**：會計期間檔（讀取檔案）
- **S#SUPF**：員工資料檔（讀取檔案）
- **GLAFPF**：會計科目檔（讀取檔案）
- **PT#BPF**：系統參數檔（讀取檔案）
- **PT#YPF**：代碼檔（讀取檔案）
- **GLI1F0D**：螢幕顯示檔（工作站檔案）

### 檔案間關聯
- 使用公司代碼（DAH01）連結各檔案
- 使用公司代碼、分錄編號（DAH01、DAH02）連結GLAHLF01取得分錄資料
- 使用公司代碼、科目代碼（DAH01、AH04）連結GLAFPF取得科目資料
- 使用員工代碼（AH26）連結S#SUPF取得員工資料
- 使用來源代碼（AH17）連結PT#YPF取得來源說明
- 使用KEYAH、KEYAF、KEY#Y等關鍵字列表進行檔案存取

## 3. 檔案欄位規格說明

### GLAHLF01 (會計分錄歷史檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AH01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AH02 | 分錄編號 | - | 9 | 文字 | 主鍵 |
| AH04 | 科目代碼 | - | 8 | 文字 | 科目代碼 |
| AH10 | 交易日期 | - | 8 | 數值 | 會計交易日期 |
| AH12 | 借方金額 | - | - | 數值 | 借方金額 |
| AH13 | 貸方金額 | - | - | 數值 | 貸方金額 |
| AH17 | 來源代碼 | - | 2 | 文字 | 來源代碼 |
| AH18 | 過帳標記 | - | 1 | 文字 | V=已過帳，空白=未過帳 |
| AH19 | 結案標記 | - | 1 | 文字 | V=已結案，空白=未結案 |
| AH20 | 作廢標記 | - | 1 | 文字 | V=已作廢，空白=未作廢 |
| AH21 | 建檔日期 | - | 8 | 數值 | 建檔日期 |
| AH25 | 過帳日期 | - | 8 | 數值 | 過帳日期 |
| AH26 | 建檔人員 | - | 10 | 文字 | 建檔人員代碼 |

### GLAFPF (會計科目檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AF01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AF02 | 科目代碼 | - | 8 | 文字 | 主鍵 |
| AF03 | 科目名稱 | - | - | 文字 | 科目名稱 |

### S#SUPF (員工資料檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| SU01 | 員工代碼 | - | 10 | 文字 | 主鍵 |
| SU02 | 員工姓名 | - | - | 文字 | 員工姓名 |

### PT#YPF (代碼檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #Y01 | 代碼類型 | - | - | 文字 | 主鍵，代碼類型 |
| #Y02 | 代碼值 | - | - | 文字 | 主鍵，代碼值 |
| #Y03 | 代碼說明 | - | - | 文字 | 代碼說明 |

### GLAKPF (會計期間檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AK01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AK09 | 日期格式 | - | 1 | 文字 | 日期格式 |
| AK11 | 日期分隔符號 | - | 1 | 文字 | 日期分隔符號 |

### PT#BPF (系統參數檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #B01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| #B02 | 公司名稱 | - | - | 文字 | 公司名稱 |

### 程式參數區域
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| $USER | 使用者代碼 | 101 | 10 | 文字 | 目前使用者代碼 |
| $USERN | 使用者姓名 | 152 | 10 | 文字 | 目前使用者姓名 |
| $A8YMD | 系統日期 | 201 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $C8YMD | 系統日期 | 209 | 8 | 數值 | 系統日期(YYYYMMDD) |
| P1F0I1 | 公司代碼 | - | 2 | 文字 | 輸入參數-公司代碼 |
| P1F0I2 | 分錄編號 | - | 9 | 文字 | 輸入參數-分錄編號 |
| @RTNC | 返回代碼 | - | 2 | 文字 | 返回代碼 |
| DAH01 | 公司代碼 | - | 2 | 文字 | 查詢的公司代碼 |
| DAH02 | 分錄編號 | - | 9 | 文字 | 查詢的分錄編號 |
| DAH04 | 科目代碼 | - | 8 | 文字 | 科目代碼 |
| DAH10 | 交易日期 | - | 8 | 數值 | 交易日期(顯示格式) |
| DAH12 | 借方金額 | - | - | 數值 | 借方金額 |
| DAH13 | 貸方金額 | - | - | 數值 | 貸方金額 |
| DAH17 | 來源代碼 | - | 2 | 文字 | 來源代碼 |
| DAH18 | 過帳標記 | - | 1 | 文字 | 過帳標記 |
| DAH19 | 結案標記 | - | 1 | 文字 | 結案標記 |
| DAH20 | 作廢標記 | - | 1 | 文字 | 作廢標記 |
| DAH21 | 建檔日期 | - | 8 | 數值 | 建檔日期(顯示格式) |
| DAH25 | 過帳日期 | - | 8 | 數值 | 過帳日期(顯示格式) |
| DAF03 | 科目名稱 | - | - | 文字 | 科目名稱 |
| D#B02 | 公司名稱 | - | - | 文字 | 公司名稱 |
| DSU02 | 建檔人員姓名 | - | - | 文字 | 建檔人員姓名 |
| D#Y03 | 來源說明 | - | - | 文字 | 來源說明 |
| TAH12 | 借方金額合計 | - | - | 數值 | 借方金額合計 |
| TAH13 | 貸方金額合計 | - | - | 數值 | 貸方金額合計 |

## 4. 輸出/入螢幕布局與說明

### 主畫面
```
                             分錄查詢畫面                               公司：XX
                                                                       日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX
分錄編號：XXXXXXXXX

建檔日期：YYYY/MM/DD        過帳日期：YYYY/MM/DD        交易日期：YYYY/MM/DD
建檔人員：XXXXXXXXXX        姓名：XXXXXXXXXXXX
來源代碼：XX                說明：XXXXXXXXXXXX
過帳標記：X                 結案標記：X                 作廢標記：X

選項 科目代碼     科目名稱                 借方金額          貸方金額
 _   XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99   999,999,999.99
 _   XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99   999,999,999.99
 _   XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99   999,999,999.99
 _   XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99   999,999,999.99
 _   XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99   999,999,999.99

                                        ===============   ===============
                                        999,999,999.99   999,999,999.99

F3=結束  F12=返回
```

### 功能鍵說明
- F3：結束
- F12：返回

### 選項說明
- 5：呼叫GLS110程式查看更多明細

## 5. 處理流程程序說明

### 主要處理流程
1. 初始化程式環境（R0100子程序）
   - 讀取系統參數
   - 設定初始值
   - 初始化子檔

2. 處理螢幕輸入（R1000子程序）
   - 顯示螢幕
   - 處理功能鍵
   - 處理選項

3. 讀取分錄資料（R1A10子程序）
   - 讀取會計分錄歷史檔
   - 顯示分錄明細資料
   - 計算借貸方合計金額

4. 處理選項（R2B00子程序）
   - 處理使用者選擇的明細
   - 呼叫GLS110程式查看更多明細

## 6. 子程序處理邏輯說明

### R0100 - 初始化處理
- 讀取PTDA01資料區
- 呼叫P31程式取得系統日期
- 初始化返回代碼和臨時變數
- 呼叫R1A00初始化子檔

### R1000 - 螢幕處理
- 顯示主畫面
- 處理功能鍵輸入
- 呼叫R2B00處理選項

### R1A00 - 子檔初始化
- 初始化子檔變數
- 清除子檔
- 設定子檔控制指標
- 呼叫R1A20設定子檔標題
- 呼叫R1A10讀取分錄資料
- 處理無資料情況

### R1A10 - 讀取分錄資料
- 設定讀取位置
- 讀取會計分錄歷史檔
- 呼叫R1A11寫入子檔

### R1A11 - 寫入子檔資料
- 設定借貸方金額
- 讀取科目資料
- 累計借貸方金額合計
- 寫入子檔記錄

### R1A20 - 設定子檔標題
- 讀取會計期間檔
- 讀取分錄主檔資料
- 格式化日期顯示
- 設定分錄狀態標記
- 讀取建檔人員資料
- 讀取來源代碼說明
- 讀取公司資料

### R1A30 - 格式化日期顯示
- 呼叫P31程式格式化日期顯示

### R2B00 - 處理選項
- 讀取子檔選項
- 呼叫R2B10處理選項
- 更新子檔

### R2B10 - 處理選項
- 處理選項5（呼叫GLS110程式查看更多明細）
- 處理返回代碼

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤處理
- 當找不到符合條件的記錄時，會顯示無資料訊息

### 訊息清冊
| 訊息代碼 | 說明 | 處理方式 |
|---------|------|---------|
| UPT2050 | 無符合條件的資料 | 顯示錯誤訊息 |

## 8. 備註
- 本程式為會計分錄查詢功能，提供使用者查詢特定分錄的詳細資料
- 程式會顯示分錄的基本資訊，包括建檔日期、過帳日期、交易日期、建檔人員等
- 程式會顯示分錄的狀態標記，包括過帳標記、結案標記、作廢標記
- 程式會顯示分錄的明細資料，包括科目代碼、科目名稱、借方金額、貸方金額等
- 程式會計算借貸方金額合計，並顯示在畫面底部
- 程式可供其他程式呼叫，用於查詢分錄詳細資料
- 使用者可以選擇特定明細，程式會呼叫GLS110程式查看更多明細資料
