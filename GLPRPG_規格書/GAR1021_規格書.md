# GAR1021 程式功能規格書

## 1. 基本資料
- **程式名稱**：GAR1021
- **程式說明**：參數日曆產生密碼設定作業子程式
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GAR1021
- **開發人員**：未指定
- **建立日期**：未指定
- **系統名稱**：會計總帳系統
- **子系統**：會計處理
- **備註**：參數日曆密碼設定作業子程式，負責報表產生與列印
- **聯絡電話**：未指定

## 2. 檔案架構與關聯圖
### 使用檔案：
- **資料庫檔案**
  - GAWF03：工作檔（參數檔案）
  - GLAHLF01：會計主檔（AH0L）
  - GLAKPF：會計參數檔
  - GLAFPF：會計參數來源檔
  - PT#YPF：參數來源檔
  - S#SUPF：參數說明檔
  - PT#BPF：部門說明檔
- **印表檔案**
  - GAR102P：參數日曆密碼設定作業報表輸出
- **相關程式**
  - P31：日期轉換程式
  - GAR102：參數日曆產生密碼設定作業（主程式）

## 3. 檔案欄位規格說明

### GLAHLF01（會計主檔）
| 欄位名稱 | 欄位說明 | 資料類型 | 備註 |
|---------|---------|---------|------|
| AH01 | 公司代號 | 字元 | 主鍵1 |
| AH02 | 參數代碼 | 字元 | 主鍵2 |
| AH04 | 會計科目 | 字元 | - |
| AH09 | 參數版本 | 數值 | - |
| AH10 | 參數日期 | 數值 | - |
| AH12 | 參數旗標 | 數值 | - |
| AH16 | 階層層級1 | 字元 | 用於L1資料控制 |
| AH17 | 參數來源 | 字元 | - |
| AH21 | 參數金額 | 數值 | - |
| AH25 | 建檔日期 | 數值 | - |
| AH26 | 建檔人員 | 字元 | - |

### 資料區定義
| 欄位名稱 | 位置 | 長度 | 說明 |
|---------|------|------|------|
| $PFMT | 1 | 1 | 參數區日期格式 |
| $PTYPE | 2 | 1 | 參數區日期型態 |
| $USER | 101-110 | 10 | 使用者代號 |
| $CPY | 125-127 | 3 | 列印份數 |
| $A8YMD | 201-208 | 8 | 系統日期 |
| $C8YMD | 209-216 | 8 | 系統日期 |
| $PRTCD | 217-218 | 2 | 列印機台 |
| $PENV | 219 | 1 | 輸出裝置 |
| DAH01 | 501-502 | 2 | 部門別 |
| DAH25F | 503-510 | 8 | 建檔日期(起) |
| DAH25T | 511-518 | 8 | 建檔日期(迄) |
| DAH10F | 519-526 | 8 | 參數日期(起) |
| DAH10T | 527-534 | 8 | 參數日期(迄) |
| DAH02F | 535-543 | 9 | 參數代碼(起) |
| DAH02T | 544-552 | 9 | 參數代碼(迄) |
| DAH26F | 553-562 | 10 | 建檔人(起) |
| DAH26T | 563-572 | 10 | 建檔人(迄) |
| DAH17F | 573-574 | 2 | 參數來源(起) |
| DAH17T | 575-576 | 2 | 參數來源(迄) |
| DAH19 | 577 | 1 | 顯示內容 |

## 4. 處理流程程序說明

### 主程序流程
1. 執行初始化程序 R1000 (初始化)
2. 執行報表設計程序 R7100 (標題處理)
3. 設定資料輸入範圍位置 (SETLL, READ)
4. 讀取符合條件的資料，並執行詳細資料處理 R2000 (資料處理)
5. 處理完所有資料後，執行彙總處理 R8100 (Group 1資料總計)
6. 最後執行結束處理 R8900 (總計與尾頁)
7. 若無資料，則執行 R8999 程序顯示無資料訊息

### 子程序處理流程

#### R1000 - 初始化處理
1. 設定指示燈與控制旗標
2. 讀取參數資料區 (PTDA01)
3. 呼叫日期格式轉換程式 (P31)
4. 設定各項報表參數與顯示內容
5. 根據參數日期範圍轉換成系統可處理的格式

#### R2000 - 資料處理
1. 檢查列印條件，若符合則印出資料明細
2. 處理參數日期與建檔日期格式轉換
3. 執行金額格式轉換與欄位顯示處理
4. 搜尋參數來源資料與說明
5. 處理會計科目與參數代碼資料
6. 輸出報表明細行

#### R7100 - 標題處理
1. 輸出報表標題內容
2. 設定頁面控制與換頁指示
3. 列印欄位標題與分隔線

#### R8100 - Group 1資料總計
1. 執行報表資料彙總處理
2. 設定層級控制標記

#### R8900 - 總計與尾頁
1. 輸出彙總資料與合計數量
2. 列印報表分隔線與結尾

#### R8999 - 無資料處理
1. 執行初始化設定
2. 印出標題與無資料訊息

## 5. 錯誤處理程序說明與訊息清冊
- 資料檔案讀取錯誤：使用指示燈40判斷檔案存取狀態
- 使用Level Break功能控制報表的分組與總計
- 使用指示燈控制標題、詳細資料與合計的列印

## 6. 備註
1. 本程式為參數日曆產生密碼設定作業的子程式，主要負責報表產生與列印功能
2. 配合主程式GAR102共同完成密碼設定功能
3. 程式使用標準的日期處理子程序以支援不同的日期格式
4. 報表格式遵循GAR102P規格產生
5. 使用L1層級控制報表分組與資料彙總 