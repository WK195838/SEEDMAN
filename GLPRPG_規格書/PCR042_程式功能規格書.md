# PCR042 程式功能規格書

## 1. 程式基本資訊

### 1.1 程式說明
- 程式名稱：PCR042
- 作者：TINA
- 建立日期：82/10/21
- 系統：會計總帳
- 子系統：報表作業
- 功能：損益表

### 1.2 相關檔案
- 輸入檔案：
  - PT#BPF：報表參數檔
- 顯示檔案：
  - PCR042D：顯示檔案
- 工作檔案：
  - LDA：區域資料區

## 2. 程式功能說明

### 2.1 主要功能
1. 初始化畫面
2. 參數驗證
3. 日期轉換
4. F4 輔助功能
5. 報表產生

### 2.2 處理流程
1. 程式進入點
   - 接收參數：*IN03, *IN10
   - 初始化畫面
   - 執行主要處理邏輯

2. 畫面初始化 (RTN010)
   - 設定系統變數
   - 初始化欄位值
   - 設定錯誤訊息

3. 參數驗證 (RTN100)
   - 檢查公司代碼
   - 驗證日期格式
   - 檢查日期範圍
   - 驗證報表選項

4. F4 輔助功能 (RTNF4)
   - 取得游標位置
   - 執行對應的輔助功能

## 3. 程式規格

### 3.1 輸入參數
```RPG
*IN03    1    // 處理模式
*IN10    1    // 初始化旗標
```

### 3.2 主要變數
```RPG
DCA01    10   // 公司代碼
COMP     1    // 比較選項
DSEL1    1    // 報表選項1
DSEL2    1    // 報表選項2
DSEL3    1    // 報表選項3
DCA02S   9    // 起始科目
DCA02E   9    // 結束科目
DCA11S   8    // 起始日期
DCA11E   8    // 結束日期
DCA10S   8    // 比較起始日期
DCA10E   8    // 比較結束日期
```

### 3.3 錯誤處理
1. 公司代碼錯誤 (UPT0010)
2. 日期格式錯誤 (UPT0040)
3. 日期範圍錯誤 (UPT0041)
4. 科目範圍錯誤 (UPT0030)

## 4. 畫面規格

### 4.1 顯示檔案 (PCR042D)
- 公司代碼輸入欄位
- 日期範圍輸入欄位
- 科目範圍輸入欄位
- 報表選項選擇欄位
- 功能鍵設定

### 4.2 功能鍵
- F3：結束
- F4：輔助功能
- F12：取消
- F5：執行報表

## 5. 報表輸出

### 5.1 報表格式
- 公司基本資料
- 報表期間
- 科目明細
- 金額統計
- 合計金額

### 5.2 輸出方式
- 螢幕顯示
- 印表機輸出
- 檔案輸出

## 6. 錯誤訊息

### 6.1 系統錯誤
- UPT0010：必輸欄位未輸入
- UPT0030：科目範圍錯誤
- UPT0040：日期格式錯誤
- UPT0041：日期範圍錯誤

### 6.2 處理錯誤
- 資料讀取錯誤
- 計算錯誤
- 輸出錯誤

## 7. 測試項目

### 7.1 功能測試
1. 參數驗證測試
2. 日期轉換測試
3. 報表產生測試
4. 錯誤處理測試

### 7.2 資料測試
1. 正常資料測試
2. 異常資料測試
3. 邊界值測試

### 7.3 效能測試
1. 大量資料處理測試
2. 報表產生時間測試
3. 系統資源使用測試

## 8. 維護說明

### 8.1 程式修改注意事項
1. 保持變數命名一致性
2. 維護錯誤訊息代碼
3. 更新程式註解
4. 保留修改記錄

### 8.2 常見問題處理
1. 日期格式錯誤處理
2. 科目範圍錯誤處理
3. 報表產生失敗處理
4. 系統資源不足處理

## 9. 輸入/輸出布局

### 9.1 顯示檔案布局 (PCR042D)

#### 9.1.1 基本資料區
```
位置    長度    欄位名稱    說明
101-110  10     $USER      使用者代號
119-124   6     $EGMDY     系統日期
162-162   1     $EVR       執行環境
125-127   3     $CPY       公司代碼
201-208   8     $A8YMD     會計年度
501-505   5     $WRHUS     倉庫代碼
513-513   1     $WRHTY     倉庫類型
598-599   2     $PRTID     印表機代碼
```

#### 9.1.2 輸入欄位區
```
位置    長度    欄位名稱    說明
601-602   2     DCA01      公司代碼
603-603   1     COMPS      比較起始
604-604   1     COMPE      比較結束
605-605   1     DSEL1      報表選項1
606-606   1     DSEL2      報表選項2
608-608   1     DSEL3      報表選項3
611-618   8     YCA11S     起始日期
621-628   8     YCA11E     結束日期
631-639   9     DCA02S     起始科目
641-649   9     DCA02E     結束科目
651-656   6     DCA11S     起始日期
661-666   6     DCA11E     結束日期
671-676   6     DCA10S     比較起始日期
681-686   6     DCA10E     比較結束日期
691-698   8     YCA10S     比較起始日期
701-708   8     YCA10E     比較結束日期
```

### 9.2 報表參數檔布局 (PT#BPF)

#### 9.2.1 報表基本資料
```
位置    長度    欄位名稱    說明
1-10     10     COMP_NO    公司代碼
11-18     8     RPT_DATE   報表日期
19-26     8     START_DATE 起始日期
27-34     8     END_DATE   結束日期
35-43     9     START_ACCT 起始科目
44-52     9     END_ACCT   結束科目
53-53     1     RPT_TYPE   報表類型
54-54     1     COMP_FLAG  比較旗標
55-62     8     COMP_START 比較起始日期
63-70     8     COMP_END   比較結束日期
```

#### 9.2.2 報表選項
```
位置    長度    欄位名稱    說明
71-71     1     OPT1       選項1
72-72     1     OPT2       選項2
73-73     1     OPT3       選項3
74-74     1     OPT4       選項4
75-75     1     OPT5       選項5
```

### 9.3 報表輸出布局

#### 9.3.1 報表標題
```
位置    長度    欄位名稱    說明
1-40     40     COMP_NAME  公司名稱
41-60     20     RPT_TITLE  報表標題
61-80     20     PERIOD     期間
81-100    20     USER_ID    使用者代號
101-120   20     PRINT_DATE 列印日期
```

#### 9.3.2 報表內容
```
位置    長度    欄位名稱    說明
1-9       9     ACCT_NO    科目代碼
10-50     41    ACCT_NAME  科目名稱
51-65     15    AMOUNT     金額
66-80     15    COMP_AMT   比較金額
81-95     15    DIFF_AMT   差異金額
96-100     5    DIFF_PCT   差異百分比
```

#### 9.3.3 報表合計
```
位置    長度    欄位名稱    說明
1-50     50     TOTAL_DESC 合計說明
51-65     15    TOTAL_AMT  合計金額
66-80     15    COMP_TOTAL 比較合計
81-95     15    DIFF_TOTAL 差異合計
96-100     5    DIFF_PCT   差異百分比
```

### 9.4 錯誤訊息布局

#### 9.4.1 錯誤訊息檔
```
位置    長度    欄位名稱    說明
1-7       7     ERR_ID     錯誤代碼
8-87     80     ERR_MSG    錯誤訊息
88-95     8     ERR_DATE   錯誤日期
96-103    8     ERR_TIME   錯誤時間
104-113  10     ERR_USER   錯誤使用者
```

#### 9.4.2 錯誤記錄檔
```
位置    長度    欄位名稱    說明
1-7       7     ERR_ID     錯誤代碼
8-87     80     ERR_MSG    錯誤訊息
88-95     8     ERR_DATE   錯誤日期
96-103    8     ERR_TIME   錯誤時間
104-113  10     ERR_USER   錯誤使用者
114-123  10     ERR_PROG   錯誤程式
124-133  10     ERR_MODULE 錯誤模組
``` 