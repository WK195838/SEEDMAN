# GLA410 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLA410
- **程式說明**：會計項目基本資料作業
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLA410
- **開發人員**：A1087 JOYCE
- **建立日期**：1992.10.27
- **修改日期**：-
- **系統**：會計總帳

## 2. 檔案架構與關聯圖

### 使用檔案
- **GLAFPF**：會計項目檔
- **GLAAPF**：科目檔案
- **GLAEPF**：銀行帳戶檔
- **GLA3PF**：會計科目檔
- **PT#BPF**：參數檔案
- **GLA410D**：螢幕顯示檔案

### 程式關係
- **主程式**：GLA410
- **呼叫程式**：
  - GLI410：會計項目查詢程式
  - GLI420：對應科目查詢程式
  - GLI430：銀行帳戶查詢程式
  - GLI450：會計科目查詢程式
  - S#S01：權限檢查程式
  - P31：日期格式處理程式
- **功能鍵**：F3(離開), F4(提示), F5(儲存), F12(返回), F18(查詢)

## 3. 檔案欄位規格說明

### 資料結構定義
- **PTDA01**
  - $PFMT (1-1)：參數格式
  - $PTYPE (2-2)：參數類型

- **DSPFDS**
  - #CSR (370-371)：游標位置

- **UDS (使用者資料區)**
  - $USER (101-110)：使用者代碼
  - $CHYMD (111-116)：日期
  - $A8YMD (201-208)：系統日期
  - $C8YMD (209-216)：日期
  - $ADD (135-135)：新增權限
  - $UPD (136-136)：修改權限
  - $DLT (137-137)：刪除權限
  - $INQ (138-138)：查詢權限
  - $USERN (152-161)：使用者名稱

- **陣列定義**
  - @A01(5)：功能權限陣列
  - WTB1(7,2)：輸入部門陣列
  - WTB2(7,20)：輸入部門名稱陣列
  - WTB3(7,1)：輸入旗標陣列
  - WTB4(5,1,0)：分派編號陣列
  - WTB5(5,1)：小計旗標陣列
  - WTB6(7,1)：確認旗標陣列

### 主要欄位說明
- **KEYAF**：會計項目檔鍵值 (DAF01+DAF02)
- **KEYAFC**：複製會計項目鍵值 (DAF01C+DAF02C)
- **KEYAA**：部門科目檔鍵值 (AA01+AA02)
- **KEYAE**：銀行帳戶檔鍵值 (DAF01+DAF10)
- **KEYA3**：會計科目檔鍵值 (DAF01+DAF22)

## 4. 輸出/入螢幕布局與說明

### 第一畫面 (DSPD1)
- **螢幕標題**：會計項目基本資料作業
- **畫面描述**：輸入基本設定資訊
- **輸入欄位**：
  - 部門代號 (DAF01)：部門代號
  - 會計項目 (DAF02)：會計項目代號
  - 複製來源 (DAF01C, DAF02C)：複製其他會計項目資料
  - 功能選擇 (DOPT)：1=新增, 2=修改, 4=刪除, 5=查詢

- **功能鍵**：
  - F3：離開
  - F18：查詢

### 第二畫面 (DSPD2)
- **螢幕標題**：會計項目基本資料作業
- **畫面描述**：設定會計項目基本資料
- **顯示欄位**：
  - 部門代號 (DAF01)：部門代號
  - 部門名稱 (D#B02)：從參數檔讀取的部門名稱
  - 會計項目 (DAF02)：會計項目代號
  
- **輸入欄位**：
  - 項目主名稱 (DAF03)：項目主名稱
  - 項目子名稱 (DAF04)：項目子名稱
  - 借貸別 (DAF05)：1=借方別, 2=貸方別
  - 增減性質 (DAF06)：1=增加, 2=減少
  - 項目類別 (DAF08)：1=資產, 2=負債
  - 固定類別 (DAF09)：1=現金, 2=銀行存款, 3=應收帳款, 4=其他
  
- **功能鍵**：
  - F3：離開
  - F12：返回前一畫面

### 第三畫面 (DSPD3)
- **螢幕標題**：會計項目基本資料作業
- **畫面描述**：設定會計項目明細資料
- **顯示欄位**：
  - 部門代號 (DAF01)：部門代號
  - 部門名稱 (D#B02)：從參數檔讀取的部門名稱
  - 會計項目 (DAF02)：會計項目代號
  - 項目主名稱 (DAF03)：項目主名稱
  
- **輸入欄位**：
  - 使用部門 (DAF11-DAF17)：對應科目資料
  - 輸入旗標 (DAF181-DAF187)：輸入旗標
  - 分派編號 (DAF191-DAF195)：分派編號
  - 小計旗標 (DAF201-DAF205)：小計旗標
  - 銀行代號 (DAF10)：銀行代號
  - 會計科目 (DAF22)：會計科目
  
- **功能鍵**：
  - F3：離開
  - F4：提示
  - F5：儲存/確認
  - F12：返回前一畫面

## 5. 處理流程程序說明

### 主要流程
1. 初始化程式環境 (R0100)
2. 進入畫面選擇迴圈，根據目前畫面ID (SCID) 選擇不同處理：
   - SC01：第一畫面處理 (R1000)
   - SC02：第二畫面處理 (R2000)
   - SC03：第三畫面處理 (R3000)
3. 程式結束

### 第一畫面處理流程 (R1000)
1. 顯示第一畫面等待使用者輸入
2. 若按F3則結束程式
3. 若按F18則呼叫會計項目查詢程式 (R1A00)
4. 檢核使用者輸入資料 (R1B00)
5. 若檢核無誤則初始化第二畫面 (R1C00)，轉至第二畫面

### 第二畫面處理流程 (R2000)
1. 顯示第二畫面等待使用者輸入
2. 若按F3則結束程式
3. 若按F12則返回第一畫面
4. 若為新增或修改模式，檢核使用者輸入資料 (R2B00)
5. 若檢核無誤則轉至第三畫面 (SC03)

### 第三畫面處理流程 (R3000)
1. 顯示第三畫面等待使用者輸入
2. 若按F3則結束程式
3. 若按F12則返回第二畫面
4. 若按F4則呼叫提示程式 (R3E00)
5. 若為新增或修改模式，檢核使用者輸入資料 (R3B00)
6. 若按F5且檢核無誤則進行檔案處理 (R3D00)
7. 處理完成後返回第一畫面

## 6. 子程序處理邏輯說明

### 程式初始化 (R0100)
1. 設定目前畫面ID為SC01
2. 設定權限標記
3. 讀取參數資料區
4. 呼叫P31設定日期格式
5. 初始化各項輸入欄位
6. 設定操作選項預設為1(新增)

### 會計項目查詢 (R1A00)
1. 呼叫S#S01檢查使用者權限
2. 呼叫GLI410查詢會計項目資料
3. 處理返回代碼

### 第一畫面檢核 (R1B00)
1. 檢查使用者權限
2. 檢查部門代號是否已輸入並有效
3. 檢查會計項目是否已輸入
4. 根據功能選項檢查資料是否存在：
   - 新增模式：檢查資料是否已存在
   - 修改/刪除/查詢模式：檢查資料是否存在
5. 複製模式：檢查複製來源資料是否存在

### 第二畫面初始化 (R1C00)
1. 根據功能選項設定畫面控制指示器
2. 根據功能選項執行不同初始化：
   - 新增且無複製：初始化空白資料 (R1C10)
   - 非新增或有複製：讀取現有資料或複製資料 (R1C20)

### 第二畫面檢核 (R2B00)
1. 檢查項目主名稱是否已輸入
2. 其他基本資料檢核

### 輔助欄位查詢 (R3E00)
1. 根據游標位置判斷欄位
2. 依據欄位類型呼叫對應的查詢程式：
   - 科目欄位：呼叫GLI420
   - 銀行代號：呼叫GLI430
   - 會計科目：呼叫GLI450
3. 將查詢結果回寫到畫面欄位

### 第三畫面檢核 (R3B00)
1. 檢查輸入部門是否有效
2. 檢查輸入旗標設定是否合理
3. 檢查分派編號設定是否合理
4. 檢查小計旗標設定是否合理
5. 檢查銀行代號和會計科目是否有效

### 檔案處理 (R3D00)
1. 根據功能選項執行不同檔案處理：
   - 新增 (R3D10)：寫入會計項目檔資料
   - 修改 (R3D20)：更新會計項目檔資料
   - 刪除 (R3D30)：刪除會計項目檔資料

### 資料轉換 (R3D11)
1. 將畫面資料轉換為檔案格式
2. 設定更新時間、日期及使用者資訊

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤訊息
- **UPT0010**：必填欄位未輸入
- **UPT0011**：相關欄位資料不一致
- **UPT0030**：無效的科目代碼
- **UPT0060**：複製來源資料不存在
- **UPT2010**：資料不存在
- **UPT2020**：資料已存在
- **UPT2150**：使用者無權限執行此功能
- **UGL0003**：分派編號設定錯誤
- **UGL0004**：無效的部門代碼

### 錯誤處理
- 設定對應的錯誤指示燈 (IN99)
- 顯示錯誤訊息
- 將游標定位在錯誤欄位

## 8. 備註

本程式用於設定會計總帳系統的會計項目基本資料，具有以下特點：

1. 提供完整的會計項目設定功能，支援新增、修改、刪除和查詢操作
2. 設計為三層式畫面流程，依序設定基本資料、會計屬性和明細資料
3. 允許從現有會計項目複製資料，方便類似項目的設定
4. 提供完整的會計屬性設定，包括借貸別、增減性質、項目類別和固定類別等
5. 支援多個對應科目的設定，每個科目可以設定輸入旗標、分派編號和小計旗標
6. 整合銀行帳戶和會計科目設定，方便與其他會計模組連結
7. 完整的權限控制機制，確保只有授權用戶可以執行特定功能
8. 標準的檔案更新機制，自動記錄更新時間與操作者

此程式作為會計總帳系統基礎設定程式之一，主要用於定義系統中的會計項目及其屬性。會計項目是財務會計系統的核心元素，用於表示各種交易類型和帳戶結構。適當的會計項目設定能確保系統能夠正確地分類和處理各種財務交易，並產生符合會計準則要求的財務報表。 