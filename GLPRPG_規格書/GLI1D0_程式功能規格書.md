# GLI1D0 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLI1D0
- **程式說明**：會計參數查詢
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLI1D0
- **開發人員**：A1150
- **建立日期**：81/11/17
- **更新日期**：
- **系統**：會計總帳
- **功能描述**：提供會計參數查詢功能，顯示會計期間參數資訊

## 2. 檔案架構與關聯圖
此程式使用以下檔案：

### 檔案清單
- **GLAKPF**：會計期間檔（讀取檔案）
- **GLADPF**：部門檔（讀取檔案）
- **GLAFPF**：會計科目檔（讀取檔案）
- **PT#BPF**：系統參數檔（讀取檔案）
- **GLI1D0D**：螢幕顯示檔（工作站檔案）

### 檔案間關聯
- 使用公司代碼（DAK01）連結各檔案
- 使用公司代碼、科目代碼（DAK01、DAK04/DAK05）連結GLAFPF取得科目資料
- 使用公司代碼、部門代碼（DAK01、DAK07/DAK08）連結GLADPF取得部門資料
- 使用KEYAK、KEYAF1、KEYAF2、KEYAD1、KEYAD2等關鍵字列表進行檔案存取

## 3. 檔案欄位規格說明

### GLAKPF (會計期間檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AK01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AK02 | 啟用狀態 | - | 1 | 文字 | V=停用，空白=啟用 |
| AK04 | 資產科目起碼 | - | 8 | 文字 | 資產科目起始代碼 |
| AK05 | 資產科目迄碼 | - | 8 | 文字 | 資產科目結束代碼 |
| AK07 | 成本中心起碼 | - | 8 | 文字 | 成本中心起始代碼 |
| AK08 | 成本中心迄碼 | - | 8 | 文字 | 成本中心結束代碼 |
| AK09 | 日期格式 | - | 1 | 文字 | 日期格式 |
| AK10 | 會計年制 | - | 1 | 文字 | 會計年制 |
| AK11 | 日期分隔符號 | - | 1 | 文字 | 日期分隔符號 |
| AK12 | 本期結帳日 | - | 8 | 數值 | 本期結帳日期 |
| AK13 | 預設年度 | - | 4 | 數值 | 預設年度 |
| AK14 | 預設期別 | - | 2 | 數值 | 預設期別 |

### GLAFPF (會計科目檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AF01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AF02 | 科目代碼 | - | 8 | 文字 | 主鍵 |
| AF03 | 科目名稱 | - | - | 文字 | 科目名稱 |

### GLADPF (部門檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AD01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AD02 | 部門代碼 | - | 8 | 文字 | 主鍵 |
| AD03 | 部門名稱 | - | - | 文字 | 部門名稱 |

### PT#BPF (系統參數檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #B01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| #B02 | 公司名稱 | - | - | 文字 | 公司名稱 |
| #B12 | 公司狀態 | - | 1 | 文字 | 公司狀態，1或2表示停用 |

### 程式參數區域
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| $USER | 使用者代碼 | 101 | 10 | 文字 | 目前使用者代碼 |
| $USERN | 使用者姓名 | 152 | 10 | 文字 | 目前使用者姓名 |
| $A8YMD | 系統日期 | 201 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $C8YMD | 系統日期 | 209 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $INQ | 查詢權限 | 138 | 1 | 文字 | Y=有查詢權限 |
| DAK01 | 公司代碼 | - | 2 | 文字 | 查詢的公司代碼 |
| DAK02 | 啟用狀態 | - | 1 | 文字 | Y=啟用，N=停用 |
| DAK04 | 資產科目起碼 | - | 8 | 文字 | 資產科目起始代碼 |
| DAK05 | 資產科目迄碼 | - | 8 | 文字 | 資產科目結束代碼 |
| DAK07 | 成本中心起碼 | - | 8 | 文字 | 成本中心起始代碼 |
| DAK08 | 成本中心迄碼 | - | 8 | 文字 | 成本中心結束代碼 |
| DAK09 | 日期格式 | - | 1 | 文字 | 日期格式 |
| DAK10 | 會計年制 | - | 1 | 文字 | 會計年制 |
| DAK11 | 日期分隔符號 | - | 1 | 文字 | 日期分隔符號顯示值 |
| DAK12 | 本期結帳日 | - | 8 | 數值 | 本期結帳日期(顯示格式) |
| DAK13 | 預設年度 | - | 4 | 數值 | 預設年度(顯示格式) |
| DAK14 | 預設期別 | - | 2 | 數值 | 預設期別(顯示格式) |
| DAF031 | 資產科目起碼名稱 | - | - | 文字 | 資產科目起始代碼名稱 |
| DAF032 | 資產科目迄碼名稱 | - | - | 文字 | 資產科目結束代碼名稱 |
| DAD031 | 成本中心起碼名稱 | - | - | 文字 | 成本中心起始代碼名稱 |
| DAD032 | 成本中心迄碼名稱 | - | - | 文字 | 成本中心結束代碼名稱 |

## 4. 輸出/入螢幕布局與說明

### 主畫面 (SC01)
```
                            會計參數查詢畫面                            公司：XX
                                                                      日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX
```

### 詳細資料畫面 (SC02)
```
                            會計參數查詢畫面                            公司：XX
                                                                      日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX        啟用狀態：X

資產科目起碼：XXXXXXXX  名稱：XXXXXXXXXXXXXXXXXXXX
資產科目迄碼：XXXXXXXX  名稱：XXXXXXXXXXXXXXXXXXXX

成本中心起碼：XXXXXXXX  名稱：XXXXXXXXXXXXXXXXXXXX
成本中心迄碼：XXXXXXXX  名稱：XXXXXXXXXXXXXXXXXXXX

日期格式：X (1=西元年 2=民國年)
會計年制：X (1=12個月制 2=13個月制)
日期分隔符號：X (1=/ 2=- 3=.)

本期結帳日：YYYY/MM/DD
預設年度：YYYY
預設期別：PP

F3=結束  F12=返回
```

### 功能鍵說明
- F3：結束
- F12：返回

## 5. 處理流程程序說明

### 主要處理流程
1. 初始化程式環境（R0100子程序）
   - 讀取系統參數
   - 設定初始值

2. 處理主畫面輸入（R1000子程序）
   - 顯示主畫面
   - 檢查輸入資料
   - 檢查查詢權限

3. 準備詳細資料畫面（R1C00子程序）
   - 讀取會計期間檔
   - 讀取科目名稱
   - 讀取部門名稱
   - 格式化日期顯示

4. 顯示詳細資料畫面（R2000子程序）
   - 顯示詳細資料畫面
   - 處理功能鍵

## 6. 子程序處理邏輯說明

### R0100 - 初始化處理
- 設定初始畫面代碼為'SC01'
- 讀取PTDA01資料區
- 呼叫P31程式取得系統日期
- 初始化公司代碼變數

### R1000 - 主畫面處理
- 顯示主畫面
- 處理功能鍵輸入
- 檢查輸入資料
- 若檢查通過，轉換為SC02畫面

### R1B00 - 檢查輸入資料
- 檢查使用者是否有查詢權限
- 檢查公司代碼是否輸入
- 檢查公司代碼是否存在
- 檢查公司是否啟用
- 讀取公司名稱
- 讀取會計期間資料

### R1C00 - 準備詳細資料畫面
- 呼叫R1C20準備詳細資料
- 設定檔案指標

### R1C20 - 準備詳細資料
- 設定啟用狀態顯示
- 讀取資產科目起始代碼名稱
- 讀取資產科目結束代碼名稱
- 讀取成本中心起始代碼名稱
- 讀取成本中心結束代碼名稱
- 設定日期格式、會計年制、日期分隔符號顯示值
- 格式化本期結帳日顯示
- 格式化預設年度顯示
- 格式化預設期別顯示

### R2000 - 詳細資料畫面處理
- 顯示詳細資料畫面
- 處理功能鍵輸入
- 處理返回功能

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤處理
- 當輸入資料有誤時，會設定錯誤指標並顯示錯誤訊息
- 當使用者無查詢權限時，會顯示權限不足訊息

### 訊息清冊
| 訊息代碼 | 說明 | 處理方式 |
|---------|------|---------|
| UPT2150 | 無查詢權限 | 顯示錯誤訊息 |
| UPT0010 | 必須輸入公司代碼 | 顯示錯誤訊息，游標停在公司代碼欄位 |
| UGL0004 | 公司代碼已停用 | 顯示錯誤訊息，游標停在公司代碼欄位 |

## 8. 備註
- 本程式為會計參數查詢功能，提供使用者查詢會計期間參數資訊
- 程式會檢查使用者是否有查詢權限
- 程式會檢查公司代碼是否有效且啟用
- 程式會顯示會計期間參數的詳細資訊，包括資產科目範圍、成本中心範圍、日期格式設定等
- 程式會格式化日期顯示，根據會計期間檔中的設定
- 程式僅提供查詢功能，不允許修改資料 