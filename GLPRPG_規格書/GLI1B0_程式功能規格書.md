# GLI1B0 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLI1B0
- **程式說明**：分錄查詢條件畫面
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLI1B0
- **開發人員**：A1150
- **建立日期**：81/11/13
- **更新日期**：
- **系統**：會計總帳
- **功能描述**：提供會計分錄資料的條件查詢功能，可依多種條件篩選分錄資料

## 2. 檔案架構與關聯圖
此程式使用以下檔案：

### 檔案清單
- **GLAHLF01**：會計分錄歷史檔（讀取檔案）
- **GLAKPF**：會計期間檔（讀取檔案）
- **PT#BPF**：系統參數檔（讀取檔案）
- **PT#YPF**：代碼檔（讀取檔案）
- **S#SUPF**：員工資料檔（讀取檔案）
- **GLI1B0D**：螢幕顯示檔（工作站檔案）

### 檔案間關聯
- 使用公司代碼（AH01/DAH01）連結各檔案
- 使用分錄編號（AH02）連結GLAHLF01取得分錄資料
- 使用員工代碼（AH26）連結S#SUPF取得員工資料
- 使用來源代碼（AH17）連結PT#YPF取得來源說明
- 使用KEY#B、KEYSU、KEY#Y等關鍵字列表進行檔案存取

## 3. 檔案欄位規格說明

### GLAHLF01 (會計分錄歷史檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AH01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AH02 | 分錄編號 | - | 9 | 文字 | 主鍵 |
| AH10 | 交易日期 | - | 8 | 數值 | 會計交易日期 |
| AH17 | 來源代碼 | - | 2 | 文字 | 來源代碼 |
| AH18 | 過帳標記 | - | 1 | 文字 | V=已過帳，空白=未過帳 |
| AH19 | 結案標記 | - | 1 | 文字 | V=已結案，空白=未結案 |
| AH20 | 作廢標記 | - | 1 | 文字 | V=已作廢，空白=未作廢 |
| AH21 | 結帳日期 | - | 8 | 數值 | 結帳日期 |
| AH25 | 作業日期 | - | 8 | 數值 | 作業執行日期 |
| AH26 | 作業人員 | - | 10 | 文字 | 作業執行人員 |

### GLAKPF (會計期間檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AK01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AK09 | 日期格式 | - | 1 | 文字 | 日期格式 |
| AK11 | 日期分隔符號 | - | 1 | 文字 | 日期分隔符號 |

### S#SUPF (員工資料檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| SU01 | 員工代碼 | - | 10 | 文字 | 主鍵 |
| SU02 | 員工姓名 | - | 20 | 文字 | 員工姓名 |

### PT#YPF (代碼檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #Y01 | 代碼類別 | - | 5 | 文字 | 主鍵，如'AH17'代表來源代碼 |
| #Y02 | 代碼 | - | 5 | 文字 | 主鍵，實際代碼值 |
| #Y03 | 代碼說明 | - | 20 | 文字 | 代碼說明 |

### 程式參數區域
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| $USER | 使用者代碼 | 101 | 10 | 文字 | 目前使用者代碼 |
| $USERN | 使用者姓名 | 152 | 10 | 文字 | 目前使用者姓名 |
| $A8YMD | 系統日期 | 201 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $C8YMD | 系統日期 | 209 | 8 | 數值 | 系統日期(YYYYMMDD) |
| DAH01 | 公司代碼 | - | 2 | 文字 | 查詢的公司代碼 |
| DAH02F | 分錄編號(起) | - | 9 | 文字 | 查詢的起始分錄編號 |
| DAH02T | 分錄編號(迄) | - | 9 | 文字 | 查詢的結束分錄編號 |
| DAH10F | 交易日期(起) | - | 8 | 數值 | 查詢的起始交易日期 |
| DAH10T | 交易日期(迄) | - | 8 | 數值 | 查詢的結束交易日期 |
| DAH17 | 來源代碼 | - | 2 | 文字 | 查詢的來源代碼 |
| DAH18 | 過帳標記 | - | 1 | 文字 | 查詢的過帳標記(1=已過帳,2=未過帳,3=全部) |
| DAH19 | 結案標記 | - | 1 | 文字 | 查詢的結案標記(1=已結案,2=未結案,3=全部) |
| DAH20 | 作廢標記 | - | 1 | 文字 | 查詢的作廢標記(1=已作廢,2=未作廢,3=全部) |
| DAH21F | 結帳日期(起) | - | 8 | 數值 | 查詢的起始結帳日期 |
| DAH21T | 結帳日期(迄) | - | 8 | 數值 | 查詢的結束結帳日期 |
| DAH25F | 作業日期(起) | - | 8 | 數值 | 查詢的起始作業日期 |
| DAH25T | 作業日期(迄) | - | 8 | 數值 | 查詢的結束作業日期 |
| DAH26 | 作業人員 | - | 10 | 文字 | 查詢的作業人員 |
| D#Y03 | 來源說明 | - | 20 | 文字 | 來源代碼說明 |

## 4. 輸出/入螢幕布局與說明

### 主畫面 (SC01)
```
                            分錄查詢條件畫面                           公司：XX
                                                                     日期：YYYY/MM/DD

公司代碼：XX        分錄編號(起)：XXXXXXXXX   分錄編號(迄)：XXXXXXXXX

作業日期(起)：YYYY/MM/DD     作業日期(迄)：YYYY/MM/DD
交易日期(起)：YYYY/MM/DD     交易日期(迄)：YYYY/MM/DD
結帳日期(起)：YYYY/MM/DD     結帳日期(迄)：YYYY/MM/DD

作業人員：XXXXXXXXXX
來源代碼：XX

過帳標記：X (1=已過帳,2=未過帳,3=全部)
結案標記：X (1=已結案,2=未結案,3=全部)
作廢標記：X (1=已作廢,2=未作廢,3=全部)
```

### 查詢結果畫面 (SC02)
```
                            分錄查詢結果畫面                           公司：XX
                                                                     日期：YYYY/MM/DD

選項  分錄編號    交易日期   結帳日期   作業日期   來源  過帳  結案  作廢  作業人員
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX
 _   XXXXXXXXX  YYYY/MM/DD YYYY/MM/DD YYYY/MM/DD  XX    X     X     X    XXXXXXXXXX

F3=結束  F12=返回  ROLL UP=下一頁
```

### 功能鍵說明
- F3：結束
- F12：返回
- ROLL UP：下一頁

## 5. 處理流程程序說明

### 主要處理流程
1. 初始化程式環境（R0100子程序）
   - 讀取系統參數
   - 設定初始值
   - 初始化查詢條件

2. 處理條件畫面輸入（R1000子程序）
   - 顯示條件畫面
   - 檢查輸入資料
   - 轉換查詢條件

3. 初始化子檔（R2A00子程序）
   - 初始化子檔
   - 清除子檔內容

4. 讀取分錄資料（R2A10子程序）
   - 根據查詢條件讀取會計分錄歷史檔
   - 顯示分錄資料於子檔

5. 處理選項（R2C00子程序）
   - 處理使用者選擇的分錄
   - 呼叫GLI1F0程式顯示分錄詳細資料

## 6. 子程序處理邏輯說明

### R0100 - 初始化處理
- 設定初始畫面代碼為'SC01'
- 讀取PTDA01資料區
- 呼叫P31程式取得系統日期
- 初始化查詢條件變數
- 設定標記預設值為'3'(全部)

### R1000 - 條件畫面處理
- 顯示條件輸入畫面
- 處理功能鍵輸入
- 檢查輸入資料
- 若檢查通過，轉換為SC02畫面

### R1100 - 檢查輸入資料
- 檢查公司代碼是否輸入
- 檢查公司代碼是否存在
- 檢查分錄編號範圍
- 檢查日期範圍（作業日期、交易日期、結帳日期）
- 檢查日期格式是否正確
- 檢查其他條件是否有效

### R2000 - 查詢結果處理
- 初始化子檔
- 處理查詢結果畫面
- 處理功能鍵

### R2200 - 查詢結果畫面處理
- 顯示查詢結果畫面
- 處理功能鍵輸入
- 處理選項

### R2A00 - 子檔初始化
- 設定子檔控制指標
- 清除子檔內容
- 初始化頁面控制變數
- 設定子檔顯示控制

### R2A10 - 讀取分錄資料
- 根據查詢條件讀取會計分錄歷史檔
- 控制每頁顯示記錄數
- 處理檔案結束情況

### R2A11 - 寫入子檔資料
- 根據查詢條件篩選記錄
- 格式化日期顯示
- 讀取來源代碼說明
- 讀取作業人員姓名
- 寫入子檔記錄

### R2C00 - 處理選項
- 讀取子檔選項
- 呼叫GLI1F0程式顯示分錄詳細資料
- 處理返回代碼

### R2N00 - 處理下一頁功能
- 檢查是否已到檔案結尾
- 讀取下一頁資料
- 更新子檔顯示

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤處理
- 當輸入資料有誤時，會設定錯誤指標並顯示錯誤訊息
- 當找不到符合條件的記錄時，會顯示無資料訊息

### 訊息清冊
| 訊息代碼 | 說明 | 處理方式 |
|---------|------|---------|
| UPT0010 | 必須輸入公司代碼 | 顯示錯誤訊息，游標停在公司代碼欄位 |
| UPT2010 | 公司代碼不存在 | 顯示錯誤訊息，游標停在公司代碼欄位 |
| UPT0040 | 日期格式錯誤 | 顯示錯誤訊息，游標停在相應日期欄位 |
| UPT0041 | 起始日期大於結束日期 | 顯示錯誤訊息，游標停在相應日期欄位 |
| UPT0042 | 起始分錄編號大於結束分錄編號 | 顯示錯誤訊息，游標停在分錄編號欄位 |
| UPT2050 | 無符合條件的資料 | 顯示錯誤訊息 |

## 8. 備註
- 本程式為會計分錄條件查詢功能，提供使用者依多種條件篩選會計分錄
- 查詢條件包括：公司代碼、分錄編號範圍、作業日期範圍、交易日期範圍、結帳日期範圍、作業人員、來源代碼、過帳標記、結案標記、作廢標記等
- 查詢結果以子檔方式顯示，每頁顯示10筆記錄
- 使用者可以選擇分錄，程式會呼叫GLI1F0程式顯示該分錄的詳細資料
- 日期格式會依據會計期間檔中的設定進行轉換顯示 