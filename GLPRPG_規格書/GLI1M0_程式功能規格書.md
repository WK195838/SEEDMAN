# GLI1M0 程式功能規格書

## 1. 基本資料
- **程式名稱**：GLI1M0
- **程式說明**：會計代碼查詢
- **程式語言**：RPG
- **程式位置**：QRPGSRC_GLPLIB/GLI1M0
- **開發人員**：TINA
- **建立日期**：1995.08.12
- **更新日期**：-
- **系統**：會計總帳
- **功能描述**：提供會計代碼查詢功能，可依照不同條件查詢代碼資料

## 2. 檔案架構與關聯圖
此程式使用以下檔案：

### 檔案清單
- **GLA7LF01**：會計代碼主檔（讀取檔案）
- **GLA7LF02**：會計代碼明細檔（讀取檔案）
- **GLAKPF**：會計期間檔（讀取檔案）
- **GLAFPF**：會計科目檔（讀取檔案）
- **PT#BPF**：系統參數檔（讀取檔案）
- **PT#YPF**：代碼檔（讀取檔案）
- **GLI1M0D**：螢幕顯示檔（工作站檔案）

### 檔案間關聯
- 使用公司代碼（DA701）連結各檔案
- 使用公司代碼、代碼類別（DA701、A705）連結GLA7LF01取得代碼資料
- 使用公司代碼、代碼類別、代碼值（DA701、A705、A702）連結GLA7LF02取得代碼明細資料
- 使用KEYSL、KEYSG、KEYA7、KEY#B、KEYAH、KEYAF等關鍵字列表進行檔案存取

## 3. 檔案欄位規格說明

### GLA7LF01 (會計代碼主檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| A701 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| A704 | 刪除標記 | - | 1 | 文字 | D=已刪除，空白=未刪除 |
| A705 | 代碼類別 | - | 12 | 文字 | 代碼類別 |
| A702 | 代碼值 | - | 9 | 文字 | 代碼值 |

### GLA7LF02 (會計代碼明細檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| A7021 | 代碼值 | - | - | 文字 | 代碼值 |
| AH04 | 科目代碼 | - | 8 | 文字 | 科目代碼 |
| AH12 | 金額 | - | - | 數值 | 金額 |

### GLAKPF (會計期間檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AK01 | 公司代碼 | - | 2 | 文字 | 主鍵 |

### GLAFPF (會計科目檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| AF01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| AF02 | 科目代碼 | - | 8 | 文字 | 主鍵 |
| AF03 | 科目名稱 | - | - | 文字 | 科目名稱 |

### PT#BPF (系統參數檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #B01 | 公司代碼 | - | 2 | 文字 | 主鍵 |
| #B02 | 公司名稱 | - | - | 文字 | 公司名稱 |

### PT#YPF (代碼檔)
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| #Y01 | 代碼類型 | - | - | 文字 | 主鍵，代碼類型 |
| #Y02 | 代碼值 | - | - | 文字 | 代碼值 |
| #Y03 | 代碼說明 | - | - | 文字 | 代碼說明 |

### 程式參數區域
| 欄位代號 | 名稱 | 位置 | 長度 | 屬性 | 說明 |
|---------|------|------|------|------|------|
| $USER | 使用者代碼 | 101 | 10 | 文字 | 目前使用者代碼 |
| $USERN | 使用者姓名 | 152 | 10 | 文字 | 目前使用者姓名 |
| $A8YMD | 系統日期 | 201 | 8 | 數值 | 系統日期(YYYYMMDD) |
| $C8YMD | 系統日期 | 209 | 8 | 數值 | 系統日期(YYYYMMDD) |
| DA701 | 公司代碼 | - | 2 | 文字 | 查詢的公司代碼 |
| DA705F | 代碼類別起始 | - | 12 | 文字 | 查詢的代碼類別起始值 |
| DA705T | 代碼類別終止 | - | 12 | 文字 | 查詢的代碼類別終止值 |
| DA702F | 代碼值起始 | - | 9 | 文字 | 查詢的代碼值起始值 |
| DA702T | 代碼值終止 | - | 9 | 文字 | 查詢的代碼值終止值 |
| CKA705 | 代碼類別檢核 | - | 1 | 文字 | 代碼類別檢核設定 |
| D02F | 代碼類別起始 | - | - | 文字 | 格式化後的代碼類別起始值 |
| D02T | 代碼類別終止 | - | - | 文字 | 格式化後的代碼類別終止值 |
| D03F | 代碼值起始 | - | - | 文字 | 格式化後的代碼值起始值 |
| D03T | 代碼值終止 | - | - | 文字 | 格式化後的代碼值終止值 |

## 4. 輸出/入螢幕布局與說明

### 主畫面 (SC01)
```
                             會計代碼查詢                                   公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX

代碼類別起始：XXXXXXXXXXXX   終止：XXXXXXXXXXXX
代碼值起始：XXXXXXXXX        終止：XXXXXXXXX

F3=結束  F4=提示
```

### 查詢結果畫面 (SC02)
```
                             會計代碼查詢                                   公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX

選項 代碼類別       代碼值        代碼說明
 _   XXXXXXXXXXXX  XXXXXXXXX    XXXXXXXXXXXXXXXXXXXX
 _   XXXXXXXXXXXX  XXXXXXXXX    XXXXXXXXXXXXXXXXXXXX
 _   XXXXXXXXXXXX  XXXXXXXXX    XXXXXXXXXXXXXXXXXXXX
 _   XXXXXXXXXXXX  XXXXXXXXX    XXXXXXXXXXXXXXXXXXXX
 _   XXXXXXXXXXXX  XXXXXXXXX    XXXXXXXXXXXXXXXXXXXX

F3=結束  F12=返回  ROLL UP=下一頁
```

### 代碼明細畫面 (SC03)
```
                             會計代碼明細                                   公司：XX
                                                                           日期：YYYY/MM/DD

公司代碼：XX        公司名稱：XXXXXXXXXXXXXXXXXXXX
代碼類別：XXXXXXXXXXXX
代碼值：XXXXXXXXX

科目代碼     科目名稱                 金額
XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99
XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99
XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99
XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99
XXXXXXXX    XXXXXXXXXXXXXXXXXXXX   999,999,999.99

F3=結束  F12=返回
```

### 功能鍵說明
- F3：結束
- F4：提示
- F12：返回
- ROLL UP：下一頁

## 5. 處理流程程序說明

### 主要處理流程
1. 初始化程式環境（R0100子程序）
   - 讀取系統參數
   - 設定初始值
   - 初始化螢幕

2. 處理主畫面輸入（R1000子程序）
   - 顯示主畫面
   - 檢核輸入資料
   - 處理功能鍵
   - 轉至查詢結果畫面

3. 處理查詢結果畫面（R2000子程序）
   - 顯示查詢結果
   - 處理功能鍵
   - 處理選項
   - 處理翻頁

4. 處理代碼明細畫面（R3000子程序）
   - 顯示代碼明細
   - 處理功能鍵

## 6. 子程序處理邏輯說明

### R0100 - 初始化處理
- 讀取PTDA01資料區
- 呼叫P31程式取得系統日期
- 初始化公司代碼和查詢條件
- 檢查代碼類別檢核設定

### R1000 - 主畫面處理
- 顯示主畫面
- 處理功能鍵輸入
- 呼叫R1100檢核輸入資料
- 轉至查詢結果畫面

### R1100 - 主畫面資料檢核
- 檢核公司代碼是否存在
- 檢核代碼類別起始值和終止值
- 檢核代碼值起始值和終止值
- 格式化查詢條件

### R1E00 - 主畫面提示處理
- 處理F4提示功能鍵
- 依據游標位置提供代碼類別提示

### R2000 - 查詢結果畫面處理
- 呼叫R2A00初始化子檔
- 顯示查詢結果畫面
- 處理功能鍵輸入
- 處理選項

### R2200 - 查詢結果畫面處理
- 顯示查詢結果畫面
- 處理功能鍵輸入
- 處理翻頁
- 呼叫R2C00處理選項

### R2A00 - 子檔初始化
- 初始化子檔變數
- 清除子檔
- 設定子檔控制指標
- 設定讀取位置
- 呼叫R2A10讀取代碼資料
- 處理無資料情況

### R2A10 - 讀取代碼資料
- 設定讀取位置
- 讀取會計代碼主檔
- 依據條件過濾資料
- 呼叫R2A11寫入子檔

### R2A11 - 寫入子檔資料
- 取得代碼說明
- 寫入子檔記錄

### R2C00 - 處理選項
- 讀取子檔選項
- 轉至代碼明細畫面
- 更新子檔

### R2E00 - 查詢結果畫面提示處理
- 處理F4提示功能鍵

### R2N00 - 處理翻頁
- 檢查是否已到最後一頁
- 呼叫R2A10讀取更多資料

### R3000 - 代碼明細畫面處理
- 呼叫R3A00初始化子檔
- 顯示代碼明細畫面
- 處理功能鍵輸入

### R3200 - 代碼明細畫面處理
- 顯示代碼明細畫面
- 處理功能鍵輸入

### R3A00 - 子檔初始化
- 初始化子檔變數
- 清除子檔
- 設定子檔控制指標
- 設定讀取位置
- 呼叫R3A10讀取代碼明細資料
- 處理無資料情況

### R3A10 - 讀取代碼明細資料
- 設定讀取位置
- 讀取會計代碼明細檔
- 呼叫R3A11寫入子檔

### R3A11 - 寫入子檔資料
- 讀取科目資料
- 寫入子檔記錄

## 7. 錯誤處理程序說明與訊息清冊

### 錯誤處理
- 當輸入資料有誤時，會顯示相應的錯誤訊息
- 當找不到符合條件的記錄時，會顯示無資料訊息

### 訊息清冊
| 訊息代碼 | 說明 | 處理方式 |
|---------|------|---------|
| UPT0010 | 必須輸入資料 | 顯示錯誤訊息 |
| UPT0042 | 起始值大於終止值 | 顯示錯誤訊息 |
| UPT2010 | 公司代碼不存在 | 顯示錯誤訊息 |
| UPT2050 | 無符合條件的資料 | 顯示錯誤訊息 |
| CPF5203 | 已到檔案結尾 | 顯示錯誤訊息 |

## 8. 備註
- 本程式為會計代碼查詢功能，提供使用者查詢特定代碼的資料
- 程式支援多種查詢條件，包括公司代碼、代碼類別和代碼值
- 程式可依據代碼類別和代碼值範圍進行查詢
- 程式會顯示代碼的明細資料，包括相關科目和金額
- 程式支援翻頁功能，可以查看更多符合條件的資料
- 程式會依據代碼類別檢核設定檢核代碼類別的有效性 