# 禮券訂單明細檔規格書（W2BDPF）

## 一、基本資訊
- **檔案名稱**：W2BDPF
- **檔案說明**：禮券訂單明細檔
- **檔案類型**：實體檔案（Physical File）
- **關鍵欄位**：BD01 + BD02
- **備註**：UNIQUE索引

## 二、記錄格式（BD0）

### 1. 欄位定義
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| BD01     | 12   | 字元 | 訂單名稱 | 必填，主鍵的一部分 |
| BD02     | 9    | 字元 | 商品編號 | 必填，主鍵的一部分 |
| BD03     | 5    | 字元 | 單位碼 | 必填 |
| BD04     | 8    | 數值(0) | 訂單數量 | 必填，無小數位 |
| BD05     | 8    | 數值(0) | 確認數量 | 必填，無小數位 |
| BD06     | 1    | 字元 | 狀態 | 必填 |
| BD07     | 12   | 字元 | 來源名稱 | 選填 |
| BD08     | 16   | 物件 | 程序 | 系統使用 |
| BDXX     | 8    | 數值(0) | 更新日期 | 系統自動產生，無小數位 |
| BDYY     | 6    | 數值(0) | 更新時間 | 系統自動產生，無小數位 |
| BDZZ     | 10   | 字元 | 更新人員 | 系統自動產生 |

### 2. 索引定義
- **主索引**：BD01（訂單名稱）+ BD02（商品編號）（唯一索引）

## 三、關聯與檢核規則

### 1. 主鍵檢核
- BD01（訂單名稱）+ BD02（商品編號）組成唯一主鍵
- 不允許重複的主鍵值

### 2. 資料完整性檢核
- BD01（訂單名稱）：必須是W2BCPF檔案中已存在的有效訂單名稱
- BD02（商品編號）：必須是系統中已登記的有效商品編號
- BD03（單位碼）：必須是系統中定義的有效單位代碼
- BD04（訂單數量）：必須是有效的數值，無小數位且大於等於0
- BD05（確認數量）：必須是有效的數值，無小數位且大於等於0
- BD06（狀態）：必須是有效的狀態碼（如：A=處理中，C=已完成，X=已取消等）
- BD07（來源名稱）：若填寫，應標識此訂單明細的原始來源

### 3. 業務規則
- 每個訂單名稱和商品編號的組合只能有一筆記錄
- 訂單名稱（BD01）必須參照W2BCPF中的訂單名稱（BC03）
- 確認數量（BD05）用於實際處理時的數量確認，不應超過訂單數量（BD04）
- 狀態碼（BD06）控制訂單明細項目的處理狀態
- 來源名稱（BD07）可用於追蹤明細項目的來源或關聯其他系統資料
- 系統會自動記錄更新相關資訊（BDXX、BDYY、BDZZ）

## 四、使用說明

### 1. 檔案用途
- 儲存禮券訂單的詳細商品資料
- 管理訂單中各項商品的數量與確認狀態
- 記錄訂單明細的處理進度
- 提供訂單處理與分析的基礎資料

### 2. 操作注意事項
- 新增記錄時，必須確保BD01、BD02組合的唯一性
- 系統會自動維護BDXX（更新日期）、BDYY（更新時間）和BDZZ（更新人員）欄位
- 修改記錄時，應注意保留原有的主鍵值，避免造成資料關聯性問題
- BD01（訂單名稱）必須先在W2BCPF中存在，確保資料完整性
- BD08（程序）欄位為系統內部使用，一般操作時不需手動維護
- 此檔案通常與W2BCPF（禮券訂單主檔）配合使用，提供訂單的完整資訊

本規格書依據W2BDPF.txt製作，完整記錄W2BDPF檔案結構、欄位屬性與檢核規則。如需調整或有其他需求，歡迎隨時告知！ 