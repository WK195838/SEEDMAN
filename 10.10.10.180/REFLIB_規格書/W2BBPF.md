# 禮券卡片明細檔規格書（W2BBPF）

## 一、基本資訊
- **檔案名稱**：W2BBPF
- **檔案說明**：禮券卡片明細檔
- **檔案類型**：實體檔案（Physical File）
- **關鍵欄位**：BB01 + BB02
- **備註**：UNIQUE索引

## 二、記錄格式（BB0）

### 1. 欄位定義
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| BB01     | 12   | 字元 | 卡片名稱 | 必填，主鍵的一部分 |
| BB02     | 6    | 數值(0) | 卡片序號 | 必填，主鍵的一部分，無小數位 |
| BB03     | 9    | 字元 | 商品編號 | 必填 |
| BB04     | 8    | 數值(0) | 卡片數量 | 必填，無小數位 |
| BB05     | 8    | 數值(0) | 發放數量 | 必填，無小數位 |
| BB06     | 8    | 數值(0) | 確認數量 | 必填，無小數位 |
| BB07     | 11   | 數值(2) | 金額 | 必填，2位小數 |
| BB08     | 9    | 數值(2) | F.O.B.-UNIT | 選填，2位小數 |
| BB08A    | 9    | 數值(2) | FHI-UNIT | 選填，2位小數 |
| BB08B    | 9    | 數值(2) | DUTY-UNIT | 選填，2位小數 |
| BB09     | 1    | 字元 | 狀態 | 必填 |
| BB10     | 128  | 物件 | 程序 | 系統使用 |
| BB11     | 1    | 字元 | 課稅碼 | 選填 |
| BBXX     | 8    | 數值(0) | 更新日期 | 系統自動產生，無小數位 |
| BBYY     | 6    | 數值(0) | 更新時間 | 系統自動產生，無小數位 |
| BBZZ     | 10   | 字元 | 更新人員 | 系統自動產生 |

### 2. 索引定義
- **主索引**：BB01（卡片名稱）+ BB02（卡片序號）（唯一索引）

## 三、關聯與檢核規則

### 1. 主鍵檢核
- BB01（卡片名稱）+ BB02（卡片序號）組成唯一主鍵
- 不允許重複的主鍵值

### 2. 資料完整性檢核
- BB01（卡片名稱）：必須是W2BAPF檔案中已存在的有效卡片名稱
- BB02（卡片序號）：必須是有效的數值，無小數位
- BB03（商品編號）：必須是系統中已登記的有效商品編號
- BB04（卡片數量）：必須是有效的數值，無小數位且大於等於0
- BB05（發放數量）：必須是有效的數值，無小數位且大於等於0
- BB06（確認數量）：必須是有效的數值，無小數位且大於等於0
- BB07（金額）：必須是有效的金額，含2位小數
- BB09（狀態）：必須是有效的狀態碼（如：A=有效，I=無效等）
- BB11（課稅碼）：若填寫，必須是系統中定義的有效課稅代碼

### 3. 業務規則
- 每個卡片名稱和卡片序號的組合只能有一筆記錄
- 卡片名稱（BB01）必須參照W2BAPF中的卡片名稱（BA03）
- 發放數量（BB05）不應超過卡片數量（BB04）
- 確認數量（BB06）用於核對實際使用情況
- 狀態碼（BB09）控制禮券卡片明細是否可用於系統操作
- 系統會自動記錄更新相關資訊（BBXX、BBYY、BBZZ）
- 金額相關欄位（BB07、BB08、BB08A、BB08B）用於不同價格計算與成本分析

## 四、使用說明

### 1. 檔案用途
- 儲存禮券卡片的詳細商品資料
- 管理禮券卡片的發放與確認數量
- 記錄禮券卡片中各商品項目的金額資訊
- 提供禮券卡片商品組合的統計與分析基礎

### 2. 操作注意事項
- 新增記錄時，必須確保BB01、BB02組合的唯一性
- 系統會自動維護BBXX（更新日期）、BBYY（更新時間）和BBZZ（更新人員）欄位
- 修改記錄時，應注意保留原有的主鍵值，避免造成資料關聯性問題
- 商品編號（BB03）應確認在系統中已存在
- BB10（程序）欄位為系統內部使用，一般操作時不需手動維護
- 此檔案通常與W2BAPF（禮券卡片主檔）配合使用，提供禮券卡片的完整資訊

本規格書依據W2BBPF.txt製作，完整記錄W2BBPF檔案結構、欄位屬性與檢核規則。如需調整或有其他需求，歡迎隨時告知！ 