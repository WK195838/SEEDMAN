# 禮券銷售明細檔規格書（W2BFPF）

## 一、基本資訊
- **檔案名稱**：W2BFPF
- **檔案說明**：禮券銷售明細檔
- **檔案類型**：實體檔案（Physical File）
- **關鍵欄位**：BF01 + BF02
- **備註**：UNIQUE索引

## 二、記錄格式（BF0）

### 1. 欄位定義
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| BF01     | 12   | 字元 | 銷售名稱 | 必填，主鍵的一部分 |
| BF02     | 9    | 字元 | 商品編號 | 必填，主鍵的一部分 |
| BF03     | 8    | 數值(0) | 數量 | 必填，無小數位 |
| BF04     | 9    | 數值(2) | 單位金額 | 必填，2位小數 |
| BF05     | 11   | 數值(2) | 金額 | 必填，2位小數 |
| BF06     | 12   | 字元 | 來源名稱 | 選填 |
| BFXX     | 8    | 數值(0) | 更新日期 | 系統自動產生，無小數位 |
| BFYY     | 6    | 數值(0) | 更新時間 | 系統自動產生，無小數位 |
| BFZZ     | 10   | 字元 | 更新人員 | 系統自動產生 |

### 2. 索引定義
- **主索引**：BF01（銷售名稱）+ BF02（商品編號）（唯一索引）

## 三、關聯與檢核規則

### 1. 主鍵檢核
- BF01（銷售名稱）+ BF02（商品編號）組成唯一主鍵
- 不允許重複的主鍵值

### 2. 資料完整性檢核
- BF01（銷售名稱）：必須是W2BEPF檔案中已存在的有效銷售名稱
- BF02（商品編號）：必須是系統中已登記的有效商品編號
- BF03（數量）：必須是有效的數值，無小數位且大於等於0
- BF04（單位金額）：必須是有效的金額，含2位小數
- BF05（金額）：必須是有效的金額，含2位小數，應等於數量乘以單位金額
- BF06（來源名稱）：若填寫，應標識此銷售明細的原始來源

### 3. 業務規則
- 每個銷售名稱和商品編號的組合只能有一筆記錄
- 銷售名稱（BF01）必須參照W2BEPF中的銷售名稱（BE03）
- 金額（BF05）通常等於數量（BF03）乘以單位金額（BF04）
- 一個銷售名稱下的所有明細金額總和應等於W2BEPF中該銷售的總金額（BE04）
- 來源名稱（BF06）可用於追蹤明細項目的來源或關聯其他系統資料
- 系統會自動記錄更新相關資訊（BFXX、BFYY、BFZZ）

## 四、使用說明

### 1. 檔案用途
- 儲存禮券銷售的詳細商品資料
- 記錄每項銷售商品的數量和金額
- 計算銷售交易的商品明細
- 提供銷售分析和報表的基礎資料

### 2. 操作注意事項
- 新增記錄時，必須確保BF01、BF02組合的唯一性
- 系統會自動維護BFXX（更新日期）、BFYY（更新時間）和BFZZ（更新人員）欄位
- 修改記錄時，應注意保留原有的主鍵值，避免造成資料關聯性問題
- BF01（銷售名稱）必須先在W2BEPF中存在，確保資料完整性
- 修改數量或單位金額時，應確保金額欄位同步更新
- 此檔案通常與W2BEPF（禮券銷售主檔）配合使用，提供銷售的完整資訊

本規格書依據W2BFPF.txt製作，完整記錄W2BFPF檔案結構、欄位屬性與檢核規則。如需調整或有其他需求，歡迎隨時告知！ 