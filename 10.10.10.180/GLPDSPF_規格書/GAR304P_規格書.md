# GAR304P 列印檔案規格書

## 基本資訊
- 檔案名稱: GAR304P
- 檔案類型: 列印檔案 (PRTF)
- 來源目錄: QDDSSRC_GLPLIB
- 程式說明: 傳票格式列印
- 系統: 台塑三井精密化學
- 子系統: 總帳系統
- 作者: MERCURY
- 建立日期: 83/02/03

## 參考檔案
- 參考檔案: GLRF (引用總帳參考欄位定義檔)

## 報表結構
報表包含五個記錄格式：
1. PH1: 報表標題與欄位標頭
2. PD1: 傳票明細資料記錄
3. PE1: 完成分隔線與訊息
4. PE2: 處理完成訊息
5. PE3: 無資料訊息

## 報表佈局

### 標題區域 (PH1)
```
                              [公司名稱]
                              傳票格式列印
公司別: [公司代號] [公司名稱]                         日期: [系統日期] 頁次: [頁碼]
傳票類別: [傳票類別] [傳票類別名稱]                   時間: [時間]
傳票號碼: [起始號碼] - [結束號碼]                     USER : [使用者ID]   <GAR304>
會計年度起: [會計年度說明]
=========================================================================================
傳票  傳票      項目      會計科目  會計科目      借方      貸方      摘要
號碼  序號      編號      代號      代號
-----------------------------------------------------------------------------------------
```

### 明細資料區域 (PD1)
```
[傳票號碼] [傳票序號] [項目編號] [會計科目代號] [會計科目代號] [借方金額] [貸方金額] [摘要說明]
```

### 完成訊息 (PE1)
```
=========================================================================================
 ***完成***
```

### 處理完成訊息 (PE2)
```
=========================================================================================
 <<GAR304>>--->產生完成
```

### 無資料訊息 (PE3)
```
   查詢此條件無任何資料
```

## 記錄格式詳細說明

### PH1 (標題與欄位標頭格式)
- 跳過前2行 (SKIPB(2))
- 每行間距設定使用SPACEA()控制

| 欄位名稱 | 參考欄位 | 說明 | 位置 | 編輯碼/格式 | 備註 |
|---------|---------|------|------|------------|------|
| - | - | 公司名稱 | 32 | MSGCON(030 URE9999 REMF) | 標題中心顯示 |
| - | - | 傳票格式列印 | 41 | - | 報表標題 |
| AR01 | AR01 | 公司代號 | 13 | - | 顯示公司代號 |
| #B02 | PTRF.#B02 | 公司名稱 | 19 | - | 參考PTRF檔 |
| $EGMDY | - | 系統日期 | 78 | EDTCDE(Y) | 長度6,0 |
| PAGNBR | - | 頁碼 | 94 | EDTCDE(Z) | 系統頁碼 |
| AR02 | AR02 | 傳票類別 | 13 | - | 傳票類別代碼 |
| AR04 | AR04 | 傳票類別名稱 | 19 | - | 傳票類別說明 |
| - | - | 時間 | 78 | TIME | 系統時間 |
| DAR03S | AR03 | 傳票起始號碼 | 13 | - | 傳票號碼範圍起始 |
| DAR03E | AR03 | 傳票結束號碼 | 20 | - | 傳票號碼範圍結束 |
| $USER | - | 使用者ID | 78 | - | 長度10 |
| DESC | - | 會計年度說明 | 15 | - | 長度80 |

### PD1 (明細資料格式)
- 每筆資料間距設定使用SPACEA(1)控制
- 指示器20控制空行輸出
- 指示器31控制欄位顯示

| 欄位名稱 | 參考欄位 | 說明 | 位置 | 編輯碼/格式 | 條件 | 備註 |
|---------|---------|------|------|------------|------|------|
| AR03 | AR03 | 傳票號碼 | 2 | - | N31 | 傳票號碼 |
| AS04 | GLRF.AS04 | 傳票序號 | 8 | - | - | 傳票序號 |
| AS05P | - | 項目編號 | 16 | - | - | 項目編號 |
| AS06 | GLRF.AS06 | 會計科目代號 | 24 | - | - | 科目編號 |
| AS07 | GLRF.AS07 | 會計科目代號 | 36 | - | - | 科目編號 |
| AS08 | GLRF.AS08 | 借方金額 | 49 | - | - | 借方金額 |
| AS09 | GLRF.AS09 | 貸方金額 | 57 | - | - | 貸方金額 |
| AS10 | GLRF.AS10 | 摘要說明 | 63 | - | - | 摘要說明 |

### PE1, PE2, PE3 (訊息格式)
- 顯示報表的分隔線與完成訊息
- PE3在無符合條件資料時顯示

## 編輯碼說明
| 編輯碼 | 說明 |
|-------|------|
| EDTCDE(Y) | 西元年月日格式 (YYMMDD) |
| EDTCDE(Z) | 數值格式，不帶前導零 |

## 指示器說明
| 指示器 | 說明 | 用途 |
|-------|------|------|
| 20 | 空行控制 | 在明細記錄中控制是否輸出空行 |
| 31 | 傳票號碼顯示控制 | 控制傳票號碼的顯示與否 |

## 資料流程
1. 報表首先印出標題區域 (PH1)，顯示報表名稱、傳票資訊與查詢條件
2. 如有符合條件的資料，則印出傳票格式資料 (PD1)
   - 使用指示器31控制傳票號碼的顯示，相同傳票號碼只顯示一次
   - 使用指示器20控制空行的輸出，使報表格式更加美觀
3. 處理完成後印出完成訊息 (PE1)
4. 最後印出處理完成訊息 (PE2)
5. 如果沒有符合條件的資料，則印出無資料訊息 (PE3)

## 與螢幕程式的關聯
- 此報表由GAR304D螢幕程式產生
- 報表的公司別與螢幕設定的DAR01S及DAR01E欄位相對應
- 報表的傳票類別與螢幕設定的DAR02S及DAR02E欄位相對應
- 報表的傳票號碼與螢幕設定的DAR03S及DAR03E欄位相對應
- 依據螢幕的輸出裝置設定($PENV)決定輸出方式
- 根據螢幕的列印份數($CPY)與印表機台號($PRTCD)控制列印參數

## 報表特性
1. 報表按傳票號碼分組列印，便於查閱同一傳票的多筆明細
2. 透過指示器31控制傳票號碼的顯示，使報表格式清晰、避免重複
3. 標題區詳細顯示查詢條件，方便使用者確認輸出內容
4. 明細區清楚展示借貸方資訊，符合會計報表標準格式
5. 參考PTRF檔案獲取公司名稱與傳票類別名稱等資訊

## 備註
- 此報表為台塑三井精密化學總帳系統的標準報表
- 報表顯示內容重點在於傳票的會計科目分錄明細
- 借貸方金額分開顯示，便於會計人員核對
- 使用標準的報表結構與格式，便於閱讀與資料查找
- 傳票為會計處理的基本單位，此報表提供標準格式化的傳票明細列印功能 