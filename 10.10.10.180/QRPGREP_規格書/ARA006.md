# 應收帳款系統—收款記錄處理程式規格書（ARA006）

## 一、基本資訊
- **程式名稱**：ARA006
- **作者**：A1118 PHILIP
- **建立日期**：81/03/27
- **修改日期**：無
- **系統**：應收帳款系統
- **子系統**：應收帳款作業子系統
- **功能說明**：收款記錄處理 (新增/修改/刪除/查詢)
- **備註**：無特殊說明

## 二、檔案架構與關聯圖

### 1. 主要檔案
- **ARAELF1**：收款邏輯檔（DISK，查詢用）
- **ARAEPF**：收款主檔（DISK，更新用）
- **ARABLF01**：收款批次邏輯檔（DISK，查詢用）
- **PA#BPF**：公司資訊檔（DISK，查詢用）
- **ARA006D**：顯示檔（WORKSTN，支援SFL）

### 2. 檔案關聯圖
```
  [ARAELF1]◄────────┐
       │               │
       ▼               │
  [ARAEPF]◄────────────┼────┐
       │               │    │
       │               │    │
  [ARABLF01]           │    │
       │               │    │
       │               │    │
  [PA#BPF]             │    │
       │               │    │
       ▼               ▼    ▼
      [ARA006]─────────►[ARA006D]
```

## 三、檔案欄位名稱、長度屬性與檢核規則

### 1. ARAEPF（收款主檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| AE01     | 2    | 字串 | 公司代號 | 必填、須存在公司主檔 |
| AE02     | 8    | 日期 | 收款日期 | 必填、有效日期 |
| AE03     | 14   | 字串 | 收款編號 | 必填、與AE01+AE02為唯一鍵 |
| AE04     | -    | 數值 | 沖銷金額 | 系統計算 |
| AEXX     | -    | 整數 | 更新日期 | 系統自動產生 |
| AEYY     | -    | 時間 | 更新時間 | 系統自動產生 |
| AEZZ     | -    | 字串 | 更新人員 | 系統自動產生 |

### 2. ARABLF01（收款批次邏輯檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| AB011    | 2    | 字串 | 公司代號 | - |
| AB021    | 14   | 字串 | 收款編號 | - |
| AB03     | -    | 字串 | 收款名稱 | - |

### 3. PA#BPF（公司資訊檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| #B03     | -    | 字串 | 公司名稱 | - |

### 4. 系統變數與設定
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| $USER    | 10   | 字串 | 使用者代碼 | - |
| $EGMDY   | 6    | 整數 | 系統日期 | - |
| $ADD     | 1    | 字元 | 新增權限 | Y/N |
| $UPD     | 1    | 字元 | 修改權限 | Y/N |
| $DLT     | 1    | 字元 | 刪除權限 | Y/N |
| $INQ     | 1    | 字元 | 查詢權限 | Y/N |
| $RMK01   | 1    | 字元 | 收款明細處理權限 | Y/N |
| $RMK02   | 1    | 字元 | 收款沖銷處理權限 | Y/N |
| WFUN     | 5    | 字串 | 功能代碼表 | - |
| WA01     | 7    | 字串 | 權限陣列 | - |

## 四、輸出入螢幕規格

### 1. 主畫面（SCR001）
- 查詢條件輸入區：
  - 公司代號（DBGN1）
  - 收款日期（DBGN2）- 預設為12/31/99
  - 收款編號（DBGN3）
- 子檔清單（SFLSR1）：顯示符合條件的收款資料
  - 顯示欄位：公司代號、收款日期、收款編號、收款批次名稱等
- 功能選項：輸入選項（1=新增、2=修改、4=刪除、5=查詢、6=明細處理、7=沖銷處理）

### 2. 明細畫面（SCR002）
- 輸入/顯示區：
  - 公司代號（DAE01）- 顯示公司名稱（#B03）
  - 收款日期（DAE02）
  - 收款編號（DAE03）- 顯示收款批次名稱（AB03）
- 功能鍵：F3=離開、F4=代碼表查詢、F12=返回

### 3. 功能鍵
- F3：離開
- F4：代碼表查詢（收款編號）
- F6：新增
- F12：取消/返回
- ENTER：執行/確認
- ROLL UP：下一頁

## 五、處理流程與子程序邏輯

### 1. 主流程
1. 初始化（RTN010）：設定環境、初始化變數、設定權限
2. 初始化畫面（RTN191）：初始化分頁顯示子檔
3. 讀取符合條件資料（RTN192/RTN193）：讀取符合條件的收款資料，顯示在子檔中
4. 畫面顯示（RTN195）：顯示主畫面與子檔資料
5. 功能處理：
   - F6（RTN120）：新增收款記錄
   - ENTER（RTN170）：處理選項與更新
   - 選項處理（RTN171/RTN180）：檢查選項並執行對應功能
6. 資料操作：
   - 新增（RTN210）：新增收款記錄
   - 修改（RTN220）：修改收款記錄
   - 刪除（RTN230）：刪除收款記錄
   - 查詢（RTN240）：顯示收款詳細資訊
   - 明細處理（選項6）：呼叫ARA0061子程式
   - 沖銷處理（選項7）：呼叫ARA0062子程式
7. 結束（LR）：釋放資源，結束程式

### 2. 子程序邏輯與運算規則
- RTN010：初始化環境、變數與權限，設定初始查詢條件
- RTN120：F6新增功能處理
- RTN170：ENTER鍵處理與查詢條件變更處理
- RTN171：讀取子檔選項並處理
- RTN180：檢查選項與權限
  - 如選項為6，呼叫ARA0061進行收款明細處理
  - 如選項為7，呼叫ARA0062進行收款沖銷處理
- RTN191：初始化子檔顯示設定，設置查詢條件
- RTN192/RTN193：讀取下一頁資料處理，將資料填入子檔
- RTN195：顯示主畫面與子檔
- RTN200：子畫面處理主控
- RTN210：新增收款記錄處理
- RTN220：修改收款記錄處理
- RTN230：刪除收款記錄處理（含確認對話框）
- RTN240：查詢收款詳細資訊
- RTN251：清除畫面欄位
- RTN252：檔案資料移至畫面
  - 公司資訊查詢與顯示
  - 日期格式轉換
  - 收款批次資訊查詢與顯示
- RTN253：畫面資料移至檔案
  - 日期格式轉換
  - 記錄更新時間與使用者
- RTN280：檢查畫面欄位資料
  - 檢查公司代號有效性
  - 檢查收款編號有效性
  - 檢查日期有效性
  - 檢查新增/修改時的資料重複性
- RTN990：權限檢查
- RTNF4：F4說明處理（收款編號查詢）
- ERRSR：錯誤處理

## 六、錯誤處理程序說明與訊息清冊

### 1. 錯誤處理程序
- 檔案存取錯誤：呼叫 ERRSR 子程序，顯示錯誤訊息
- 權限檢查錯誤：呼叫 RTN990 子程序，檢查使用者權限
- 資料確認：刪除資料前，使用 WDS000 程式進行使用者確認
- 資料驗證：由 RTN280 子程序進行各項資料檢查

### 2. 狀態指示器清冊
| 指示器 | 訊息說明 |
|--------|----------|
| *IN03  | F3離開功能鍵 |
| *IN04  | F4說明功能鍵 |
| *IN06  | F6新增功能鍵 |
| *IN12  | F12返回功能鍵 |
| *IN25  | 下一頁功能 |
| *IN30  | 新增模式 |
| *IN31  | 修改模式 |
| *IN40  | 記錄未找到 |
| *IN46  | 記錄讀取結束 |
| *IN50  | 子檔顯示控制 |
| *IN51  | 子檔控制顯示 |
| *IN52  | 子檔初始化 |
| *IN53  | 子檔讀取結束 |
| *IN54  | 子檔讀取模式 |
| *IN60  | 一般錯誤訊息 |
| *IN61  | 收款編號錯誤 |
| *IN62  | 收款日期錯誤 |
| *IN88  | 已有沖銷金額，不可刪除 |
| *IN90  | 日期格式錯誤 |
| *IN91  | 資料已存在 |
| *IN92  | 公司代號錯誤 |
| *IN93  | 必填欄位未輸入 |
| *IN94  | 無資料訊息 |
| *IN95  | 操作完成訊息 |
| *IN96  | 無權限執行此功能 |
| *IN97  | 檔案鎖定錯誤 |
| *IN98  | 已到最後一頁 |
| *IN99  | 系統錯誤訊息 |

## 七、相關程式與函式庫

### 1. 子程式
- **ARA0061**：收款明細處理子程式
  - 參數：公司代號、收款編號、收款日期
  - 功能：處理收款記錄的明細項目
- **ARA0062**：收款沖銷處理子程式
  - 參數：公司代號、收款編號、收款日期
  - 功能：處理收款記錄的沖銷處理

### 2. 共用函式
- **WDS000**：確認對話框處理
  - 參數：確認旗標
  - 功能：顯示確認對話框，返回使用者選擇結果
- **WDS0141**：收款編號查詢
  - 參數：收款編號部分資訊
  - 功能：提供收款編號查詢功能，返回完整收款編號
- **RES001**：日期格式轉換處理
  - 參數：格式類型、輸入日期、輸出日期
  - 功能：處理不同格式間的日期轉換
- **P09**：日期格式檢查處理
  - 參數：日期、檢查結果
  - 功能：檢查日期格式有效性
- **P50**：錯誤訊息處理
  - 參數：錯誤訊息
  - 功能：顯示錯誤訊息
- **S#S01**：系統權限檢查
  - 參數：使用者、功能、權限結果
  - 功能：檢查使用者是否具有指定功能的執行權限

本規格書依據 ARA006.txt 製作，完整記錄 ARA006 程式結構、檔案欄位、處理流程與錯誤處理。如需調整或有其他需求，歡迎隨時告知！ 