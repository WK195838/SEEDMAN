# 應收帳款系統—期末資料備份程式規格書（ARA015）

## 一、基本資訊
- **程式名稱**：ARA015
- **作者**：AN MING HSIA
- **建立日期**：82/03/03
- **系統**：應收帳款系統
- **子系統**：應收帳款作業
- **功能說明**：期末資料備份作業
- **修改記錄**：
  - M001 (98.11.17) MANUAL MODIFY BY MICHELLE FOR Y2K

## 二、檔案架構與關聯圖

### 1. 主要檔案
- **ARA015D**：顯示檔（WORKSTN）

### 2. 檔案關聯圖
```
  [ARA015]──►[ARA015D]
```

## 三、檔案欄位名稱、長度屬性與檢核規則

### 1. ARA015D（顯示檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| DSG01S   | 2    | 字串 | 起始公司代號 | 可為空，預設為*LOVAL |
| DSG01E   | 2    | 字串 | 結束公司代號 | 可為空，預設為*HIVAL |
| DSG04    | 5    | 字串 | 單別代號 | 預設為'A0002' |
| DSG06S   | 6    | 日期 | 起始備份日期 | 必須為有效日期 |
| DSG06E   | 6    | 日期 | 結束備份日期 | 必須為有效日期且不可小於起始日期 |
| YSG06S   | 8    | 日期 | 工作起始日期 | Y2K格式日期 |
| YSG06E   | 8    | 日期 | 工作結束日期 | Y2K格式日期 |

### 2. 系統變數與參數
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| $USER    | 10   | 字串 | 使用者代碼 | - |
| $CHYMD   | 6    | 整數 | Y2K系統日期 | - |
| $EGMDY   | 6    | 整數 | 舊系統日期 | - |
| LDA      | -    | 區域 | 本地資料區 | - |
| W6       | 6    | 日期 | 暫存日期 | - |
| P0901I   | 6    | 日期 | P09輸入參數 | - |
| P0901O   | 1    | 字元 | P09輸出參數 | - |
| S001I1   | 3    | 字串 | RES001輸入參數 | - |
| S001I2   | 6    | 日期 | RES001輸入參數 | - |
| S001O1   | 6    | 日期 | RES001輸出參數 | - |

## 四、輸出入螢幕規格

### 1. 主畫面（DSPD1）
- 期末備份條件設定區：
  - 公司代號區間：
    - 起始公司代號（DSG01S）- 預設為空（*LOVAL）
    - 結束公司代號（DSG01E）- 預設為空（*HIVAL）
  - 單別代號（DSG04）- 預設為'A0002'
  - 備份日期區間：
    - 起始備份日期（DSG06S）
    - 結束備份日期（DSG06E）

### 2. 功能鍵
- F3：離開
- F14：執行備份
- ENTER：確認執行

## 五、處理流程與子程序邏輯

### 1. 主流程
1. 初始化（RTN010）：設定環境、初始化變數
2. 畫面顯示（EXFMT DSPD1）：顯示主畫面進行條件設定
3. 功能處理：
   - F3：離開系統
   - F14：執行備份
   - ENTER：確認執行，進行欄位檢查（RTN100）
4. 輸出LDA（OUTLDA）：將處理結果寫入本地資料區
5. 結束（LR）：釋放資源，結束程式

### 2. 子程序邏輯與運算規則
- RTN010：初始化環境與變數
  - 初始化畫面欄位（DSG04='A0002'、DSG01S、DSG01E、DSG06S、DSG06E）
  - 初始化Y2K日期變數（YSG06S、YSG06E）
  - 設置畫面狀態指示器
  
- RTN100：檢查畫面欄位
  - 處理公司代號：
    - 如果起始公司代號為空，設為*LOVAL
    - 如果結束公司代號為空，設為*HIVAL
    - 檢查起始代號是否小於等於結束代號
  - 檢查起始備份日期格式是否有效，使用P09程式驗證
  - 處理Y2K日期格式轉換，使用RES001程式和HB@68L子程序
  - 檢查結束備份日期格式是否有效，使用P09程式驗證
  - 處理Y2K日期格式轉換，使用RES001程式和HB@68L子程序
  - 檢查起始日期是否小於等於結束日期
  
- OUTLDA：輸出LDA處理
  - 將處理結果寫入本地資料區

## 六、錯誤處理程序說明與訊息清冊

### 1. 錯誤處理程序
- 欄位檢查錯誤：設置對應的錯誤指示器，在下次畫面顯示時提示用戶
- 日期格式檢查：呼叫P09程式驗證日期格式
- Y2K日期處理：使用RES001程式和HB@68L子程序處理世紀轉換

### 2. 訊息清冊
| 指示器 | 訊息說明 |
|--------|----------|
| *IN03  | F3離開功能鍵 |
| *IN10  | 初始化旗標 |
| *IN14  | F14執行備份功能鍵 |
| *IN60  | 一般錯誤訊息 |
| *IN61  | 公司代號區間錯誤 |
| *IN62  | 日期區間錯誤 |
| *IN63  | 結束日期格式錯誤 |
| *IN69  | 日期區間錯誤（起始日期大於結束日期） |
| *IN92  | 公司代號前後順序錯誤 |
| *IN93  | 日期格式無效 |
| *IN98  | 已傳入參數旗標 |
| *IN99  | 系統錯誤 |

## 七、特殊處理邏輯

### 1. 日期處理
- 使用P09程式檢查日期格式是否有效
- 使用RES001程式將MDY格式日期轉換為畫面顯示格式
- 使用HB@68L子程序進行6位元到8位元的日期格式轉換（Y2K）

### 2. 公司代號處理
- 提供彈性查詢功能：
  - 如未指定起始公司代號，預設為*LOVAL（最小值）
  - 如未指定結束公司代號，預設為*HIVAL（最大值）
  - 允許使用者針對特定公司範圍進行備份

### 3. 單別代號處理
- 預設單別代號為'A0002'
- 程式針對指定單別的資料進行備份處理

### 4. 執行流程控制
- 使用多個控制旗標控制程式執行流程
- *IN10：初始化完成旗標
- *IN98：參數已傳入旗標

本規格書依據ARA015.txt製作，完整記錄ARA015程式結構、檔案欄位、處理流程與錯誤處理。如需調整或有其他需求，歡迎隨時告知！ 