# 應收帳款系統—應收帳款明細查詢程式規格書（ARI028）

## 一、基本資訊
- **程式名稱**：ARI028
- **作者**：AN MING HSIA
- **建立日期**：1993/07/07
- **系統**：應收帳款系統
- **子系統**：銷貨單明細
- **功能說明**：應收帳款明細查詢（支援多條件查詢、分頁顯示、明細查詢、F4說明、資料列印等功能）
- **備註**：程式負責查詢與顯示應收帳款明細，並支援多種查詢條件與分頁操作。

## 二、檔案架構與關聯圖

### 1. 主要檔案
- **ARACLF07**：應收帳款主檔（DISK，關鍵字：DBGN1、DBGN2、DBGN3）
- **MTMEPF**：明細參照檔（DISK，關鍵字：AC02、AC03）
- **ARI028D**：顯示檔（WORKSTN，分頁顯示、支援SFL）

### 2. 檔案關聯圖
```
[ARACLF07]───┬─(查詢/主鍵)───┐
             │                │
             │                ▼
         [ARI028]───(顯示/查詢)──→[ARI028D]
             │                ▲
             └─(明細查詢)───→[MTMEPF]
```

## 三、檔案欄位名稱、長度屬性與檢核規則

### 1. ARACLF07（應收帳款主檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| DBGN1    | 5    | 字串 | 主鍵1 | 必填、唯一 |
| DBGN2    | 4    | 字串 | 主鍵2 | 必填、唯一 |
| DBGN3    | 6    | 整數 | 主鍵3 | 必填、唯一、日期格式 |
| ...      | ...  | ...  | ...  | ... |

### 2. MTMEPF（明細參照檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| AC02     | 5    | 字串 | 明細代號 | 必填 |
| AC03     | 4    | 字串 | 明細序號 | 必填 |
| AC04     | 6    | 整數 | 明細日期 | 必填、日期格式 |
| AC07     | 6    | 整數 | 明細到期日 | 必填、日期格式 |
| ...      | ...  | ...  | ...  | ... |

### 3. ARI028D（顯示檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| $USER    | 10   | 字串 | 使用者代碼 | 必填 |
| $EGMDY   | 6    | 整數 | 系統日期 | 必填、日期格式 |
| $USERN   | 10   | 字串 | 使用者名稱 | - |
| $CHYMD   | 6    | 整數 | 系統日期 | - |
| $ADD/$UPD/$DLT/$INQ | 1 | 字元 | 操作別 | - |
| ...      | ...  | ...  | ...  | ... |

## 四、輸出入螢幕規格

### 1. 查詢條件輸入區
- DBGN1（主鍵1）、DBGN2（主鍵2）、DBGN3（主鍵3，日期）
- 支援F4說明鍵查詢欄位說明

### 2. 明細顯示區（分頁SFL）
- 顯示查詢結果，支援分頁、上下頁切換
- 欄位：主檔與明細檔相關欄位（如明細代號、明細日期、到期日等）

### 3. 功能鍵
- F3：離開
- F4：說明/HELP
- 其他：分頁、查詢、列印等

## 五、處理流程與子程序邏輯

### 1. 主流程
1. 初始化（RTN010）：設定環境、初始化變數、載入系統日期、清空查詢條件
2. 查詢（RTN170）：依輸入條件查詢主檔，若有資料則顯示明細，否則顯示無資料訊息
3. 分頁顯示（RTN191、RTN192、RTN193）：分頁讀取與顯示查詢結果，支援上下頁切換
4. 明細查詢（KEYME）：查詢明細檔，顯示明細內容
5. 輸出（RTN195）：將查詢結果顯示於螢幕
6. 結束（LR）：釋放資源，結束程式

### 2. 子程序邏輯與運算規則
- RTN010：初始化環境、變數、系統日期
- RTN170：依查詢條件查詢主檔，若無資料則顯示訊息
- RTN191：初始化分頁顯示相關變數
- RTN192：讀取下一頁資料
- RTN193：將查詢結果寫入分頁顯示區
- RTN195：顯示查詢結果於螢幕
- ERRSR：錯誤處理，呼叫訊息處理程式（P50）

## 六、錯誤處理程序說明與訊息清冊

### 1. 錯誤處理程序
- 讀取檔案失敗、查無資料、資料格式錯誤等，皆會呼叫 ERRSR 子程序，顯示對應錯誤訊息。
- 錯誤訊息由訊息處理程式（P50）統一管理。

### 2. 訊息清冊（部分範例）
| 訊息代碼 | 說明 |
|----------|------|
| P5001O   | 資料存取失敗，請聯絡系統管理員 |
| ...      | ... |

## 七、其他備註
- 日期欄位皆需檢核格式正確，並轉換顯示格式（如 YMD、MDY 等）
- 支援多條件查詢與分頁顯示，提升查詢效率
- 程式結構模組化，便於維護與擴充

本規格書依據 ARI028.txt 製作，完整記錄 ARI028 程式結構、檔案欄位、處理流程與錯誤處理。如需調整或有其他需求，歡迎隨時告知！ 