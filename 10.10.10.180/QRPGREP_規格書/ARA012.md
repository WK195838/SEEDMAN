# 應收帳款系統—應收帳款明細報表程式規格書（ARA012）

## 一、基本資訊
- **程式名稱**：ARA012
- **作者**：A1087 JOYCE
- **建立日期**：81/03/18
- **修改日期**：81/04/18 BY STEPHANIE
- **系統**：應收帳款系統
- **子系統**：應收帳款作業
- **功能說明**：應收帳款明細報表作業
- **修改記錄**：
  - B2MOD：Y2K相關修改

## 二、檔案架構與關聯圖

### 1. 主要檔案
- **ARA012D**：顯示檔（WORKSTN）

### 2. 檔案關聯圖
```
  [ARA012]──►[ARA012D]
```

## 三、檔案欄位名稱、長度屬性與檢核規則

### 1. ARA012D（顯示檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| DSC01    | 2    | 字串 | 公司代號 | - |
| DSC08    | 6    | 日期 | 報表日期 | 必須為有效日期 |
| YY       | 4    | 字串 | 年份 | 自動從DSC08轉換 |
| MMDD     | 4    | 字串 | 月日 | 自動從DSC08轉換 |
| WSC08    | 8    | 日期 | 工作日期 | Y2K格式日期 |

### 2. 系統變數與參數
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| $USER    | 10   | 字串 | 使用者代碼 | - |
| $CHYMD   | 8    | 整數 | Y2K系統日期 | - |
| $EGMDY   | 6    | 整數 | 舊系統日期 | - |
| LDA      | -    | 區域 | 本地資料區 | - |
| CHKMDY   | 8    | 日期 | 檢查用日期 | - |
| P6201I   | 8    | 日期 | P62輸入參數 | - |
| P6202I   | 4    | 整數 | P62輸入參數 | - |
| P6201O   | 8    | 日期 | P62輸出參數 | - |
| S001I1   | 3    | 字串 | RES001輸入參數 | - |
| S001I2   | 8    | 日期 | RES001輸入參數 | - |
| S001O1   | 8    | 日期 | RES001輸出參數 | - |
| P0901I   | 8    | 日期 | P09輸入參數 | - |
| P0911O   | 1    | 字元 | P09輸出參數 | - |

## 四、輸出入螢幕規格

### 1. 主畫面（DSPD1）
- 報表條件設定區：
  - 公司代號（DSC01）
  - 報表日期（DSC08）

### 2. 功能鍵
- F3：離開
- F14：執行報表
- ENTER：確認執行

## 五、處理流程與子程序邏輯

### 1. 主流程
1. 初始化（RTN010）：設定環境、初始化變數
2. 畫面顯示（EXFMT DSPD1）：顯示主畫面進行條件設定
3. 功能處理：
   - F3：離開系統
   - F14：執行報表
   - ENTER：確認執行，進行欄位檢查（RTN100）
4. 輸出LDA（OUTLDA）：將處理結果寫入本地資料區
5. 結束（LR）：釋放資源，結束程式

### 2. 子程序邏輯與運算規則
- RTN010：初始化環境與變數
  - 初始化畫面欄位（WSC08、DSC08）
  - 處理上個月日期：呼叫P62程式獲取上個月日期
  - 呼叫RES001程式轉換日期格式
  - 設置畫面狀態指示器
  
- RTN100：檢查畫面欄位
  - 檢查報表日期格式與有效性：呼叫P09程式進行檢查
  - 處理Y2K日期格式轉換：使用HB@24Y子程序
  - 將日期拆分為年份（YY）和月日（MMDD）部分
  
- OUTLDA：輸出LDA處理
  - 將處理結果寫入本地資料區

## 六、錯誤處理程序說明與訊息清冊

### 1. 錯誤處理程序
- 日期檢查錯誤：呼叫P09程式進行日期格式檢查
- Y2K日期處理：使用HB@24Y子程序處理世紀轉換
- 檢查錯誤：設置對應的錯誤指示器，在下次畫面顯示時提示用戶

### 2. 訊息清冊
| 指示器 | 訊息說明 |
|--------|----------|
| *IN03  | F3離開功能鍵 |
| *IN10  | 初始化旗標 |
| *IN14  | F14執行報表功能鍵 |
| *IN60  | 一般錯誤訊息 |
| *IN61  | 日期格式錯誤 |
| *IN93  | 日期格式檢查錯誤 |
| *IN98  | 已傳入參數旗標 |
| *IN99  | 系統錯誤 |

## 七、特殊處理邏輯

### 1. 日期處理
- 上個月日期獲取：
  - 使用P62程式處理日期計算，獲取上個月日期
  - 參數P6202I = -1表示減去1個月
- 日期格式轉換：
  - 使用RES001程式將系統日期格式轉換為畫面顯示格式
  - 參數S001I1 = 'YMD'指定轉換格式
- Y2K日期處理：
  - DSC08日期欄位拆分為年份（YY）和月日（MMDD）處理
  - 使用HB@24Y子程序進行2位數到4位數年份的轉換

### 2. 報表控制
- 通過LDA（本地資料區）將報表參數傳遞給實際產生報表的程式
- 使用參數傳遞（*IN03、*IN14、*IN98）控制報表程式的執行流程

### 3. 執行流程控制
- 使用多個控制旗標控制程式執行流程
- *IN10：初始化完成旗標
- *IN98：參數已傳入旗標

本規格書依據ARA012.txt製作，完整記錄ARA012程式結構、檔案欄位、處理流程與錯誤處理。如需調整或有其他需求，歡迎隨時告知！ 