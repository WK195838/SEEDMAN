# 應收帳款系統—客戶帳款設定程式規格書（ARA002）

## 一、基本資訊
- **程式名稱**：ARA002
- **作者**：A1139 JANE
- **建立日期**：81/03/20
- **修改日期**：無
- **系統**：應收帳款系統
- **子系統**：應收帳款子系統
- **功能說明**：客戶帳款資料設定（新增/修改/刪除/查詢）
- **備註**：無特殊說明

## 二、檔案架構與關聯圖

### 1. 主要檔案
- **ARABPF**：客戶帳款主檔（DISK，更新用）
- **ARABLF**：客戶帳款查詢檔（DISK，查詢用）
- **PA#APF**：參數主檔（DISK，查詢用）
- **PA#BPF**：公司資訊檔（DISK，查詢用）
- **ARA002D**：顯示檔（WORKSTN，支援SFL）

### 2. 檔案關聯圖
```
[ARABPF]◄────(更新)────┐
   ▲                    │
   │                    │
   └────(查詢)────┐    │
                   │    │
[ARABLF]◄────────┐│    │
                  ││    │
            ┌─────┘│    │
            │      │    │
[PA#APF]◄───┼──────┘    │
            │           │
            │           │
            ▼           ▼
        [ARA002]──────►[ARA002D]
            ▲
            │
[PA#BPF]◄───┘
```

## 三、檔案欄位名稱、長度屬性與檢核規則

### 1. ARABPF（客戶帳款主檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| AB01     | -    | 字串 | 客戶代號 | 必填、唯一鍵 |
| AB02     | -    | 字串 | 交易類型 | 必填、唯一鍵 |
| AB03     | -    | 字串 | 說明 | 可空白 |
| AB04     | -    | 字串 | 帳款類型 | 必填、需存在於參數檔 |
| AB05     | -    | 整數 | 帳款金額 | 必填、正數 |
| AB06     | -    | 字串 | 幣別 | 必填、需存在於參數檔 |
| ABXX     | -    | 整數 | 建立/修改日期 | 系統自動產生 |
| ABYY     | -    | 整數 | 建立/修改時間 | 系統自動產生 |
| ABZZ     | -    | 字串 | 建立/修改者 | 系統自動產生 |

### 2. ARABLF（客戶帳款查詢檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| AB01     | -    | 字串 | 客戶代號 | - |
| AB02     | -    | 字串 | 交易類型 | - |
| AB03     | -    | 字串 | 說明 | - |
| AB04     | -    | 字串 | 帳款類型 | - |
| AB05     | -    | 整數 | 帳款金額 | - |
| AB06     | -    | 字串 | 幣別 | - |
| ...      | ...  | ...  | ...  | ... |

### 3. PA#APF（參數主檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| #A01     | -    | 字串 | 參數類型 | - |
| #A02     | -    | 字串 | 參數代碼 | - |
| #A03     | -    | 字串 | 參數說明 | - |
| ...      | ...  | ...  | ...  | ... |

### 4. PA#BPF（公司資訊檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| #B03     | -    | 字串 | 公司名稱 | - |
| ...      | ...  | ...  | ...  | ... |

### 5. 系統變數與設定
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| $USER    | 10   | 字串 | 使用者代碼 | 必填 |
| $EGMDY   | 6    | 整數 | 系統日期 | 必填、日期格式 |
| $ADD     | 1    | 字元 | 新增權限 | Y/N |
| $UPD     | 1    | 字元 | 修改權限 | Y/N |
| $DLT     | 1    | 字元 | 刪除權限 | Y/N |
| $INQ     | 1    | 字元 | 查詢權限 | Y/N |
| WFUN     | -    | 字串 | 功能代碼表 | - |
| WA01     | 5    | 字串 | 權限陣列 | - |

## 四、輸出入螢幕規格

### 1. 主畫面（SCR001）
- 查詢條件輸入區：客戶代號（DBGN1）、交易類型（DBGN2）
- 子檔清單（SFL）：顯示符合條件的客戶帳款資料
- 功能選項：輸入選項（1=新增、2=修改、4=刪除、5=查詢）

### 2. 明細畫面（SCR002）
- 輸入/顯示區：
  - 客戶代號（DAB01）- 顯示公司名稱（#B03）
  - 交易類型（DAB02）
  - 說明（DAB03）
  - 帳款類型（DAB04）- 顯示帳款類型說明（D#A031）
  - 帳款金額（DAB05）
  - 幣別（DAB06）- 顯示幣別說明（D#A032）
- 欄位檢核：相關檢核規則與訊息
- 功能鍵：F3=離開、F4=代碼表查詢、F5=重新整理、F12=返回

### 3. 功能鍵
- F3：離開
- F4：代碼表查詢（帳款類型、幣別）
- F5：重新整理/更新資料
- F6：新增
- F12：取消/返回
- ENTER：執行/確認
- ROLL UP：下一頁

## 五、處理流程與子程序邏輯

### 1. 主流程
1. 初始化（RTN010）：設定環境、初始化變數、設定權限
2. 初始化畫面（RTN191）：初始化分頁顯示子檔
3. 讀取符合條件資料（RTN192/RTN193）：讀取符合條件的客戶帳款資料，依照分頁大小顯示
4. 畫面顯示（RTN195）：顯示主畫面與子檔資料
5. 功能處理：
   - F6（RTN120）：新增資料
   - ENTER（RTN170）：處理選項與更新
   - 選項處理（RTN171/RTN180）：檢查選項並執行對應功能
6. 資料操作（RTN200-RTN253）：新增、修改、刪除、查詢資料
7. 結束（LR）：釋放資源，結束程式

### 2. 子程序邏輯與運算規則
- RTN010：初始化環境、變數與權限
- RTN100：查詢客戶資料（公司名稱）
- RTN111：查詢帳款類型說明
- RTN112：查詢幣別說明
- RTN120：F6新增功能處理
- RTN170：ENTER鍵處理與資料檢查
- RTN171：讀取子檔選項並處理
- RTN180：檢查選項與權限
- RTN191：初始化子檔顯示設定
- RTN192/RTN193：讀取下一頁資料處理
- RTN195：顯示主畫面與子檔
- RTN200：子畫面處理主控
- RTN210：新增資料處理
- RTN220：修改資料處理
- RTN230：刪除資料處理
- RTN240：查詢資料處理
- RTN251：清除畫面欄位
- RTN252：檔案資料移至畫面
- RTN253：畫面資料移至檔案
- RTN270：F5處理（重新整理）
- RTN280：檢查畫面欄位資料
- RTN990：權限檢查
- RTNF4：F4說明處理（代碼表查詢）
- ERRSR：錯誤處理

## 六、錯誤處理程序說明與訊息清冊

### 1. 錯誤處理程序
- 檔案存取錯誤：呼叫 ERRSR 子程序，顯示錯誤訊息
- 權限檢查錯誤：呼叫 RTN990 子程序，檢查使用者權限
- 資料輸入錯誤：由 RTN280 子程序檢查資料合法性，顯示錯誤訊息
- 帳款類型與幣別檢查：由 RTN111、RTN112 子程序檢查，顯示錯誤訊息

### 2. 訊息清冊（部分範例）
| 指示器 | 訊息說明 |
|--------|----------|
| *IN60  | 輸入資料有誤 |
| *IN61  | 交易類型有誤 |
| *IN62  | 交易類型有誤 |
| *IN63  | 帳款類型有誤或不存在 |
| *IN65  | 幣別有誤或不存在 |
| *IN90  | 權限不足 |
| *IN91  | 資料已存在，不可新增 |
| *IN93  | 必填欄位未輸入 |
| *IN96  | 無權限執行此功能 |
| *IN98  | 已到最後一頁 |
| *IN99  | 系統錯誤，請聯絡系統管理員 |

## 七、其他備註
1. 代碼表查詢功能（F4）：
   - 帳款類型代碼表：提供選擇帳款類型代碼
   - 幣別代碼表：提供選擇幣別代碼
2. 權限控制：依據使用者權限，控制可執行功能
3. 游標位置判斷：使用 DSPFDS 中的 #CSR 欄位判斷游標位置，用於 F4 說明功能
4. 主鍵組合：客戶代號(AB01) + 交易類型(AB02) 為唯一鍵

本規格書依據 ARA002.txt 製作，完整記錄 ARA002 程式結構、檔案欄位、處理流程與錯誤處理。如需調整或有其他需求，歡迎隨時告知！ 