# 應收帳款系統—應收帳款明細報表程式規格書（ARA009）

## 一、基本資訊
- **程式名稱**：ARA009
- **作者**：A1087 JOYCE
- **建立日期**：81/03/18
- **修改日期**：81/04/18 BY STEPHANIE
- **系統**：應收帳款系統
- **子系統**：應收帳款作業
- **功能說明**：應收帳款明細報表作業
- **修改記錄**：
  - M001 (98.11.02) MANUAL MODIFY BY MICHELLE FOR Y2K
  - M002 (98.11.25) 010101 = *LOVAL/123199=*HIVAL

## 二、檔案架構與關聯圖

### 1. 主要檔案
- **ARAALF01**：應收帳款邏輯檔案（DISK，查詢用）
- **ARA009D**：顯示檔（WORKSTN）

### 2. 檔案關聯圖
```
  [ARAALF01]──►[ARA009]──►[ARA009D]
```

## 三、檔案欄位名稱、長度屬性與檢核規則

### 1. ARAALF01（應收帳款邏輯檔案）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| AA02     | -    | 日期 | 帳款日期 | - |
| AA09     | -    | 日期 | 開始日期 | - |

### 2. ARA009D（顯示檔）
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| DSC01    | 2    | 字串 | 公司代號區間 | - |
| DSC01S   | 2    | 字串 | 起始公司代號 | - |
| DSC01E   | 2    | 字串 | 結束公司代號 | 不可小於起始代號 |
| DSC02S   | 12   | 字串 | 起始客戶代號 | - |
| DSC02E   | 12   | 字串 | 結束客戶代號 | 不可小於起始代號 |
| DSC31S   | 2    | 字串 | 起始地區代號 | - |
| DSC31E   | 2    | 字串 | 結束地區代號 | 不可小於起始代號 |
| DSC33S   | -    | 字串 | 起始客戶類別 | - |
| DSC33E   | -    | 字串 | 結束客戶類別 | 不可小於起始類別 |
| DSC39S   | 6    | 日期 | 起始帳款日期 | 必須為有效日期，預設為010192 |
| DSC39E   | 6    | 日期 | 結束帳款日期 | 必須為有效日期且不可小於起始日期，預設為123129 |
| YYS      | 4    | 字串 | 起始帳款年份 | 自動從DSC39S轉換 |
| MMDDS    | 4    | 字串 | 起始帳款月日 | 自動從DSC39S轉換 |
| YYE      | 4    | 字串 | 結束帳款年份 | 自動從DSC39E轉換 |
| MMDDE    | 4    | 字串 | 結束帳款月日 | 自動從DSC39E轉換 |
| WSC39S   | 8    | 日期 | 工作起始日期 | Y2K格式日期，自動轉換 |
| WSC39E   | 8    | 日期 | 工作結束日期 | Y2K格式日期，自動轉換 |

### 3. 系統變數與參數
| 欄位名稱 | 長度 | 屬性 | 說明 | 檢核規則 |
|----------|------|------|------|----------|
| $USER    | 10   | 字串 | 使用者代碼 | - |
| $EGMDY   | 6    | 整數 | 系統日期 | - |
| LDA      | -    | 區域 | 本地資料區 | - |
| WAA02    | -    | 日期 | 工作日期 | - |

## 四、輸出入螢幕規格

### 1. 主畫面（DSPD1）
- 報表條件設定區：
  - 公司代號區間：
    - 起始公司代號（DSC01S）
    - 結束公司代號（DSC01E）
  - 客戶代號區間：
    - 起始客戶代號（DSC02S）
    - 結束客戶代號（DSC02E）
  - 地區代號區間：
    - 起始地區代號（DSC31S）
    - 結束地區代號（DSC31E）
  - 客戶類別區間：
    - 起始客戶類別（DSC33S）
    - 結束客戶類別（DSC33E）
  - 帳款日期區間：
    - 起始帳款日期（DSC39S）- 預設為010192
    - 結束帳款日期（DSC39E）- 預設為123129

### 2. 功能鍵
- F3：離開
- F4：代碼表查詢（客戶類別、地區代號）
- F14：執行報表
- ENTER：確認執行

## 五、處理流程與子程序邏輯

### 1. 主流程
1. 初始化（RTN010）：設定環境、初始化變數
2. 畫面顯示（EXFMT DSPD1）：顯示主畫面進行條件設定
3. 功能處理：
   - F3：離開系統
   - F4：代碼表查詢（RTNF4）
   - F14：執行報表
   - ENTER：確認執行，進行欄位檢查（RTN100）
4. 輸出LDA（OUTLDA）：將處理結果寫入本地資料區
5. 結束（LR）：釋放資源，結束程式

### 2. 子程序邏輯與運算規則
- RTN010：初始化環境與變數
  - 初始化畫面欄位
  - 設定日期區間預設值（從系統日期取得）
  - 設置畫面狀態指示器
  
- RTN100：檢查畫面欄位
  - 檢查公司代號區間
  - 檢查客戶類別區間
  - 檢查地區代號區間
  - 檢查日期格式與區間
  - 檢查客戶代號區間
  - 檢查帳款日期是否已存在邏輯檔案
  
- RTNF4：F4代碼表查詢處理
  - 根據游標位置判斷查詢項目
  - 客戶類別：呼叫WDS018程式查詢
  - 地區代號：呼叫WDS007程式查詢
  
- OUTLDA：輸出LDA處理
  - 將處理結果寫入本地資料區

## 六、錯誤處理程序說明與訊息清冊

### 1. 錯誤處理程序
- 欄位檢查錯誤：設置對應的錯誤指示器，在下次畫面顯示時提示用戶
- 日期檢查錯誤：呼叫P09程式進行日期檢查
- Y2K日期處理：特殊處理世紀轉換，確保日期格式正確

### 2. 訊息清冊
| 指示器 | 訊息說明 |
|--------|----------|
| *IN03  | F3離開功能鍵 |
| *IN04  | F4說明功能鍵 |
| *IN10  | 初始化旗標 |
| *IN14  | F14執行報表功能鍵 |
| *IN46  | 記錄讀取結束 |
| *IN60  | 一般錯誤訊息 |
| *IN61  | 日期區間錯誤 |
| *IN62  | 日期格式錯誤 |
| *IN63  | 客戶類別區間錯誤 |
| *IN64  | 地區代號區間錯誤 |
| *IN65  | 客戶代號區間錯誤 |
| *IN66  | 公司代號區間錯誤 |
| *IN91  | 帳款日期檢查錯誤 |
| *IN93  | 日期格式檢查錯誤 |
| *IN98  | 終止處理旗標 |
| *IN99  | 系統錯誤 |

## 七、報表格式說明

### 1. 應收帳款明細報表
- 報表標題：應收帳款明細報表
- 報表條件：顯示所選擇的查詢條件
- 標題行：公司代號、客戶代號、客戶名稱、發票號碼、發票日期、到期日、帳款金額、已收金額、未收金額
- 分組合計：依公司代號、客戶代號進行小計
- 報表合計：顯示報表總金額

### 2. 特殊處理邏輯
- 日期區間處理：
  - 預設起始日期為01/01/92（M002修改為*LOVAL）
  - 預設結束日期為12/31/29（M002修改為*HIVAL）
  - 進行Y2K日期格式轉換
  
- 代碼表查詢處理：
  - 客戶類別查詢：透過WDS018程式進行查詢
  - 地區代號查詢：透過WDS007程式進行查詢
  
- 邏輯檔檢查：
  - 檢查查詢條件是否與已開啟的邏輯檔案有重疊

本規格書依據ARA009.txt製作，完整記錄ARA009程式結構、檔案欄位、處理流程與錯誤處理。如需調整或有其他需求，歡迎隨時告知！ 