# 銷貨模組操作手冊

## 一、基本資訊

| 項目 | 說明 |
|------|------|
| **系統名稱** | 10.10.10.180 企業管理系統 |
| **模組名稱** | 銷貨模組 |
| **模組代號** | NP (Sales) |
| **功能名稱** | 銷貨管理 |
| **功能代號** | NP001 |
| **撰寫人員** | 系統分析師 |
| **撰寫日期** | 2024/12/19 |
| **審核人員** | 專案經理 |
| **審核日期** | 2024/12/19 |
| **版本編號** | v1.0 |
| **適用對象** | 業務人員、客服人員、倉管人員、系統使用者 |

---

## 二、功能概述

### 2.1 功能目的
銷貨模組是企業銷售管理的核心，主要用於管理客戶資料、處理銷貨訂單、管理出貨流程、產生銷貨報表，確保銷售業務的順利進行，為企業營收管理提供完整的資料基礎。

### 2.2 功能範圍
- **主要功能**：訂單管理、客戶管理、出貨管理、價格管理、報表管理
- **輔助功能**：資料查詢、資料匯出、資料備份、系統監控
- **限制功能**：已出貨訂單不能修改、已取消訂單不能恢復

### 2.3 使用時機
- **日常使用**：每日訂單處理、客戶資料維護、出貨處理
- **特殊情況**：月底結帳、年度結帳、銷貨報表產生
- **不適用情況**：系統維護期間、資料庫備份期間

---

## 三、操作流程

### 3.1 整體操作流程圖

```mermaid
flowchart TD
    A[登入系統] --> B[選擇銷貨模組]
    B --> C[進入銷貨管理主畫面]
    C --> D[選擇操作功能]
    D --> E{功能類型}
    E -->|訂單管理| F[訂單操作]
    E -->|客戶管理| G[客戶操作]
    E -->|出貨管理| H[出貨操作]
    E -->|價格管理| I[價格操作]
    E -->|報表管理| J[報表操作]
    F --> K[完成操作]
    G --> K
    H --> K
    I --> K
    J --> K
    K --> L[返回主畫面]
    L --> M[結束]
```

### 3.2 訂單管理操作流程

#### 3.2.1 新增訂單流程
```mermaid
flowchart TD
    A[點擊新增訂單] --> B[系統產生訂單編號]
    B --> C[選擇客戶代碼]
    C --> D[輸入訂單日期]
    D --> E[輸入交貨日期]
    E --> F[新增訂單明細]
    F --> G[選擇產品代碼]
    G --> H[輸入數量]
    H --> I[輸入單價]
    I --> J[系統計算金額]
    J --> K{是否還有明細}
    K -->|是| F
    K -->|否| L[檢查訂單資料]
    L --> M{資料是否正確}
    M -->|否| N[顯示錯誤訊息]
    N --> F
    M -->|是| O[儲存訂單]
    O --> P[顯示成功訊息]
    P --> Q[返回主畫面]
```

#### 3.2.2 查詢訂單流程
```mermaid
flowchart TD
    A[點擊查詢訂單] --> B[設定查詢條件]
    B --> C[選擇日期範圍]
    C --> D[選擇客戶範圍]
    D --> E[選擇訂單狀態]
    E --> F[點擊執行查詢]
    F --> G[顯示查詢結果]
    G --> H{是否要檢視詳細}
    H -->|是| I[點擊訂單記錄]
    I --> J[顯示訂單詳細]
    J --> K[返回查詢結果]
    H -->|否| L[結束查詢]
    K --> L
```

### 3.3 客戶管理操作流程

```mermaid
flowchart TD
    A[選擇客戶管理] --> B[顯示客戶清單]
    B --> C{選擇操作}
    C -->|新增客戶| D[點擊新增客戶]
    C -->|修改客戶| E[選擇客戶記錄]
    C -->|刪除客戶| F[選擇客戶記錄]
    D --> G[輸入客戶資料]
    E --> H[修改客戶資料]
    F --> I[確認刪除]
    G --> J[儲存客戶]
    H --> J
    I --> J
    J --> K[更新客戶清單]
    K --> L[返回客戶管理]
```

### 3.4 出貨管理操作流程

```mermaid
flowchart TD
    A[選擇出貨管理] --> B[顯示待出貨訂單]
    B --> C[選擇要出貨的訂單]
    C --> D[檢查訂單狀態]
    D --> E{訂單是否可出貨}
    E -->|否| F[顯示狀態錯誤訊息]
    F --> C
    E -->|是| G[顯示出貨確認畫面]
    G --> H[確認出貨資料]
    H --> I[更新訂單狀態]
    I --> J[更新庫存數量]
    J --> K[產生出貨單]
    K --> L[記錄出貨日誌]
    L --> M[顯示成功訊息]
    M --> N[返回出貨清單]
```

---

## 四、畫面說明

### 4.1 銷貨管理主畫面

#### 4.1.1 主畫面配置圖
```
┌─────────────────────────────────────────────────────────────┐
│                    銷貨管理系統 - 主畫面                      │
├─────────────────────────────────────────────────────────────┤
│ 功能選單區域                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [銷貨管理] [訂單管理] [客戶管理] [出貨管理] [價格管理]   │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 查詢條件區域                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 日期範圍: [2024/01/01] 至 [2024/12/31]                │ │
│ │ 客戶範圍: [全部客戶 ▼]    訂單狀態: [全部狀態 ▼]        │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 功能按鈕區域                                                │
│ [新增訂單] [查詢訂單] [客戶維護] [出貨處理] [報表產生]    │
├─────────────────────────────────────────────────────────────┤
│ 訂單資料顯示區域                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 訂單編號 │ 客戶名稱 │ 訂單日期 │ 訂單金額 │ 狀態 │ 交貨日期 │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ NP001    │ 客戶A   │ 2024/12/19│ 50,000   │ 確認 │ 2024/12/25│
│ │ NP002    │ 客戶B   │ 2024/12/19│ 75,000   │ 草稿 │ 2024/12/26│
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 4.1.2 區域說明
| 區域名稱 | 位置 | 功能說明 | 操作方式 |
|----------|------|----------|----------|
| **功能選單區域** | 畫面頂部 | 選擇主要功能模組 | 點擊對應功能選單 |
| **查詢條件區域** | 畫面上部 | 設定查詢條件 | 選擇或輸入查詢條件 |
| **功能按鈕區域** | 畫面中部 | 執行各種功能 | 點擊對應功能按鈕 |
| **資料顯示區域** | 畫面底部 | 顯示查詢結果 | 點擊記錄檢視詳細 |

### 4.2 訂單輸入畫面

#### 4.2.1 訂單輸入配置圖
```
┌─────────────────────────────────────────────────────────────┐
│                    訂單輸入 - 新增訂單                      │
├─────────────────────────────────────────────────────────────┤
│ 訂單標頭區域                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 訂單編號: [NP001        ] (系統自動產生)                │ │
│ │ 客戶代碼: [C001 ▼]      客戶名稱: [客戶A              ] │ │
│ │ 訂單日期: [2024/12/19 ▼]                               │ │
│ │ 交貨日期: [2024/12/25 ▼]                               │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 訂單明細區域                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 序號 │ 產品代碼 │ 產品名稱 │ 數量 │ 單價 │ 金額 │ 備註 │
│ ├─────────────────────────────────────────────────────────┤ │
│ │  1   │ [P001 ▼] │ [產品A  ] │ [100] │ [500] │ [50,000] │ [    ] │
│ │  2   │ [P002 ▼] │ [產品B  ] │ [ 50] │ [500] │ [25,000] │ [    ] │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 訂單總計: 75,000                                           │
│ 功能按鈕區域                                                │
│ [新增明細] [儲存訂單] [取消]                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 五、功能鍵說明

### 5.1 功能鍵清單
| 功能鍵 | 功能名稱 | 使用時機 | 操作說明 |
|--------|----------|----------|----------|
| **F1** | 線上說明 | 需要協助時 | 顯示線上說明文件 |
| **F2** | 查詢 | 要執行查詢時 | 執行查詢作業 |
| **F3** | 新增 | 要新增資料時 | 進入新增畫面 |
| **F4** | 修改 | 要修改資料時 | 進入修改畫面 |
| **F5** | 刪除 | 要刪除資料時 | 執行刪除作業 |
| **F6** | 儲存 | 要儲存資料時 | 儲存輸入的資料 |
| **F7** | 取消 | 要取消操作時 | 取消當前操作 |
| **F8** | 列印 | 要列印資料時 | 執行列印作業 |
| **F9** | 匯出 | 要匯出資料時 | 執行資料匯出 |
| **F10** | 離開 | 要離開功能時 | 離開當前功能 |

### 5.2 常用功能鍵操作

#### 5.2.1 新增訂單 (F3)
- **使用時機**：需要新增銷貨訂單時
- **操作步驟**：
  1. 按 F3 鍵或點擊 [新增訂單] 按鈕
  2. 系統顯示訂單輸入畫面
  3. 輸入訂單標頭資料
  4. 輸入訂單明細資料
  5. 按 F6 儲存訂單

#### 5.2.2 查詢訂單 (F2)
- **使用時機**：需要查詢訂單資料時
- **操作步驟**：
  1. 設定查詢條件
  2. 按 F2 鍵或點擊 [查詢訂單] 按鈕
  3. 系統執行查詢並顯示結果

---

## 六、常見問題與解答

### 6.1 訂單相關問題

#### 6.1.1 客戶代碼不存在
**問題描述**：輸入客戶代碼時顯示客戶不存在錯誤

**可能原因**：
- 客戶代碼輸入錯誤
- 客戶尚未建立
- 客戶已停用

**解決方案**：
1. 檢查客戶代碼是否正確
2. 使用客戶查詢功能確認客戶存在
3. 聯絡管理員新增客戶或啟用停用客戶

#### 6.1.2 產品庫存不足
**問題描述**：儲存訂單時顯示庫存不足錯誤

**可能原因**：
- 訂購數量超過可用庫存
- 庫存資料未更新
- 其他訂單已預留庫存

**解決方案**：
1. 減少訂購數量
2. 檢查庫存資料是否正確
3. 等待庫存補充或聯絡倉管人員

### 6.2 系統相關問題

#### 6.2.1 無法進入訂單功能
**問題描述**：點擊訂單管理後無法進入功能畫面

**可能原因**：
- 使用者權限不足
- 系統連線異常
- 功能暫時停用

**解決方案**：
1. 檢查使用者權限設定
2. 重新登入系統
3. 聯絡系統管理員

---

## 七、錯誤處理

### 7.1 錯誤訊息說明

#### 7.1.1 業務錯誤訊息
| 錯誤代碼 | 錯誤訊息 | 錯誤原因 | 解決方案 |
|----------|----------|----------|----------|
| NP101 | 客戶代碼不存在，請檢查客戶代碼 | 輸入的客戶代碼在系統中不存在 | 查詢正確的客戶代碼，或聯絡管理員新增客戶 |
| NP102 | 客戶已停用，無法建立訂單 | 選擇的客戶狀態為停用 | 選擇其他有效客戶，或聯絡管理員啟用客戶 |

#### 7.1.2 使用者錯誤訊息
| 錯誤代碼 | 錯誤訊息 | 錯誤原因 | 解決方案 |
|----------|----------|----------|----------|
| NP201 | 訂單日期格式錯誤，請使用YYYYMMDD格式 | 日期輸入格式不正確 | 使用正確的日期格式，如：20241219 |
| NP202 | 交貨日期不能早於訂單日期 | 交貨日期設定錯誤 | 設定正確的交貨日期，不能早於訂單日期 |

### 7.2 錯誤處理步驟

#### 7.2.1 一般錯誤處理流程
1. **記錄錯誤訊息**：記下錯誤代碼和錯誤訊息
2. **嘗試基本解決方案**：根據錯誤訊息嘗試解決
3. **尋求協助**：如無法解決，聯絡系統管理員

---

## 八、使用技巧

### 8.1 操作效率提升

#### 8.1.1 快速輸入技巧
- **使用客戶代碼**：直接輸入客戶代碼比選擇客戶名稱快
- **複製訂單**：相似訂單可使用複製功能
- **使用範本**：建立常用訂單範本

#### 8.1.2 查詢技巧
- **組合查詢條件**：使用多個條件組合查詢
- **儲存查詢條件**：將常用查詢條件儲存起來
- **使用進階查詢**：利用進階查詢功能進行複雜查詢

### 8.2 資料庫操作技巧

#### 8.2.1 資料庫查詢優化
```sql
-- 基本查詢（推薦使用）
SELECT AH02, AH03, AH04, AH06, AH05, AH08
FROM NPAHPF
WHERE AH04 BETWEEN '20240101' AND '20241231'
  AND AH15 = 'A'
ORDER BY AH04 DESC, AH02;

-- 使用索引的查詢（效能最佳）
SELECT /*+ INDEX(NPAHPF NPH002) */
    AH02, AH03, AH04, AH06, AH05, AH08
FROM NPAHPF
WHERE AH03 = 'C001' 
  AND AH04 = '20241219'
  AND AH15 = 'A';

-- 統計查詢（用於報表）
SELECT 
    AH03 AS CUSTOMER_CODE,
    COUNT(*) AS ORDER_COUNT,
    SUM(AH06) AS TOTAL_AMOUNT
FROM NPAHPF
WHERE AH04 BETWEEN '20240101' AND '20241231'
  AND AH15 = 'A'
GROUP BY AH03
HAVING COUNT(*) > 0
ORDER BY TOTAL_AMOUNT DESC;
```

#### 8.2.2 資料庫維護操作
```sql
-- 檢查訂單資料完整性
SELECT 
    AH05 AS ORDER_STATUS,
    COUNT(*) AS ORDER_COUNT,
    SUM(AH06) AS TOTAL_AMOUNT
FROM NPAHPF
WHERE AH15 = 'A'
GROUP BY AH05
ORDER BY AH05;

-- 檢查客戶訂單統計
SELECT 
    AH03 AS CUSTOMER_CODE,
    COUNT(*) AS ORDER_COUNT,
    SUM(AH06) AS TOTAL_AMOUNT,
    MAX(AH04) AS LAST_ORDER_DATE
FROM NPAHPF
WHERE AH15 = 'A'
GROUP BY AH03
HAVING COUNT(*) > 0
ORDER BY TOTAL_AMOUNT DESC;

-- 清理無效資料
DELETE FROM NPWF01 
WHERE WF0103 = 'E' 
  AND WF0106 < CURRENT_DATE - 30;
```

#### 8.2.3 資料庫效能監控
```sql
-- 監控訂單查詢效能
SELECT 
    SUBSTR(EXECUTION_TIME, 1, 10) AS EXEC_DATE,
    COUNT(*) AS QUERY_COUNT,
    AVG(ELAPSED_TIME) AS AVG_ELAPSED_TIME,
    MAX(ELAPSED_TIME) AS MAX_ELAPSED_TIME
FROM NP_QUERY_LOG
WHERE EXECUTION_TIME >= CURRENT_DATE - 7
GROUP BY SUBSTR(EXECUTION_TIME, 1, 10)
ORDER BY EXEC_DATE DESC;

-- 監控資料表大小
SELECT 
    TABLE_NAME,
    TABLE_SCHEMA,
    ROUND(TABLE_SIZE/1024/1024, 2) AS SIZE_MB,
    ROW_COUNT
FROM NP_TABLE_STATS
WHERE TABLE_SCHEMA = 'NPDATA'
ORDER BY TABLE_SIZE DESC;
```

### 8.3 進階操作技巧

#### 8.3.1 批次處理操作
```sql
-- 批次更新訂單狀態
UPDATE NPAHPF 
SET AH05 = '3', 
    AH13 = 'BATCH_USER', 
    AH14 = CURRENT_TIMESTAMP
WHERE AH05 = '2' 
  AND AH08 <= CURRENT_DATE
  AND AH15 = 'A';

-- 批次產生訂單編號
INSERT INTO NPWF01 (WF0101, WF0102, WF0103, WF0106)
SELECT 
    'WF' || RIGHT('0000000000' || ROW_NUMBER() OVER(), 10),
    'NP' || RIGHT('000000000000' || ROW_NUMBER() OVER(), 12),
    'P',
    CURRENT_TIMESTAMP
FROM SYSIBM.SYSDUMMY1
CONNECT BY LEVEL <= 1000;
```

#### 8.3.2 資料匯出操作
```sql
-- 匯出訂單資料到CSV格式
SELECT 
    AH02 || ',' ||
    AH03 || ',' ||
    AH04 || ',' ||
    AH06 || ',' ||
    AH05 || ',' ||
    AH08 || ',' ||
    AH11 || ',' ||
    AH12
FROM NPAHPF
WHERE AH15 = 'A'
ORDER BY AH04, AH02;

-- 匯出客戶訂單統計
SELECT 
    AC01 || ',' ||
    AC02 || ',' ||
    AC03 || ',' ||
    AC07 || ',' ||
    AC08
FROM NPACPF
WHERE AC10 = 'A'
ORDER BY AC01;
```

---

## 九、相關功能

### 9.1 相關功能清單
| 功能名稱 | 功能代號 | 關聯性 | 說明 |
|----------|----------|--------|------|
| 總帳模組 | GL | 後置 | 銷貨訂單會產生應收帳款 |
| 產品模組 | PT | 前置 | 需要產品資料和庫存資訊 |
| 採購模組 | PC | 相關 | 影響庫存數量 |

---

## 十、聯絡資訊

### 10.1 技術支援聯絡方式
| 支援類型 | 聯絡方式 | 聯絡時間 | 回應時間 |
|----------|----------|----------|----------|
| **一般問題** | 系統管理員 | 上班時間 | 2小時內 |
| **技術問題** | 技術支援 | 上班時間 | 4小時內 |
| **緊急問題** | 專案經理 | 24小時 | 立即回應 |

---

**文件建立日期**：2024年12月19日  
**最後更新日期**：2024年12月19日  
**文件狀態**：草稿  
**下次檢討日期**：2025年1月19日 