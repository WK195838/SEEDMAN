     A****************************************************************
     H*   泛太資訊科技開發股份有限公司－版權所有    TEL:27313250   *
     H*                                                              *
     H*    PROGRAM-ID   : PYA4131                                    *
     H*    PROGRAM NAME :特休結算代金處理                          *
     H*    AUTHOR       :                                            *
     H*    CREATE DATE  : 91/11/19                                   *
     H*    UPDATE DATE  :                                            *
     H*    SYSTEM       :人事薪資系統                              *
     H****************************************************************
     FPYEMPF  IP  E           K        DISK
     FPYLTPF  UF  E           K        DISK                      A
     FPYPYPF  IF  E           K        DISK
     FPYPMPF  IF  E           K        DISK
     FPYLUPF  UF  E           K        DISK                      A
     FPY2HPF  UF  E           K        DISK                      A
     I*================================================================
     I/COPY PYDDSSRC,PYPMDS01
     I/COPY PYDDSSRC,PYEMDS01
     I           UDS
     I                                      101 110 $USER
     I                                      135 135 $ADD
     I                                      136 136 $UPD
     I                                      137 137 $DLT
     I                                      138 138 $INQ
     I                                      141 141 $RMK03
     I                                      142 142 $DEP
     I                                      152 161 $USERN
     I                                      173 176 $COR
     I                                      201 2080$A8YMD
     I                                      201 2060$A8YM
     I                                      201 2040$A8Y
     I                                      211 2160DDATE
     I*
     I                                      501 502 DEM01
     I                                      503 5050DYY
     I                                      506 5090WYY
     C*==============================================================*
     C*                    KLIST
     C*==============================================================*
     C           KEY2H     KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C                     KFLD           WYY              年度
     C           KEY2H1    KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C                     KFLD           LYEAR            去年度
     C           KEYPY     KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C           KEYLT     KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C                     KFLD           WYY              年度
     C           KEYLT1    KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C                     KFLD           LYEAR            去年度
     C*PYLUPF
     C                     Z-ADD12        LMTH    20       去年月底
     C           KEYLU     KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C                     KFLD           LYEAR            去年度
     C                     KFLD           LMTH             去年月底
     C           KEYLU1    KLIST
     C                     KFLD           EM01             公司編號
     C                     KFLD           EM02             員工編號
     C                     KFLD           WYY              今年度
     C                     KFLD           LMTH             今年月底
     C*PYPMPF
     C                     MOVEL'01'      PM01    2
     C           KEYPM     KLIST
     C                     KFLD           PM01
     C                     KFLD           EM01             公司編號
     C*==============================================================*
     C*                    MAIN ROUTINE
     C*==============================================================*
     C*
     C           KEYPM     CHAINPM0                  41
  01-C           *IN41     IFEQ '0'
    C*
    C                     MOVELEM01      H201      P      公司
    C                     MOVELEM02      H202      P      員工
    C           DYY       ADD  1911      WYY
    C                     MOVELWYY       H203             特休年度
    C           WYY       MULT 100       KK      60       特休年度
    C           KK        ADD  12        H207             處理年月
    C*
    C*-------------------------------------------------------------***
    C*年休補休金額計算
    C*
    C                     Z-ADD*ZERO     YSR     70       年休補發
    C                     Z-ADD*ZERO     HSAR   103       時薪
    C                     Z-ADD*ZERO     WPY03   70       底薪
    C*
    C           WYY       SUB  1         LYEAR   40
    C*          KEYLU     CHAINLU0                  46
  02-C*          *IN46     IFEQ '0'
    C*          LU05      SUB  LU06      WLU     51
  03-C*          WLU       IFEQ *ZERO
    C*                    Z-ADD*ZERO     YSR
  03*C*                    ELSE
    C*
    C           KEYPY     CHAINPY0                  47
    C  N47                Z-ADDPY03      WPY03
    C*
  04-C           EM100     IFEQ '1'                        月薪
    C           WPY03     DIV  PM102     HSAR      H
    C                     DIV  PM101     HSAR      H
  04*C                     ELSE
  05-C           EM100     IFEQ '2'                        日薪
    C           WPY03     DIV  PM101     HSAR      H
  05-C                     END
  04-C                     END
    C*          HSAR      MULT WLU       YSR       H      年休補發
  03-C*                    END
    C*
  02-C*                    END
    C*-------------------------------------------------------------***
    C           KEY2H     CHAINH20                  43
  06-C           *IN43     IFEQ '1'
    C*-------------------------------------------------------------***
    C*特休天數計算：（特休時數＝特休天數＊８）
    C*
    C                     Z-ADD*ZERO     H204
    C*
    C*特休基準年月＝當年度的１２月
    C*　　　（ＥＸ：如計算９１年度之特休，特休基準年月＝９１／１２）
    C*
    C                     Z-ADD*ZERO     H203YM  60       本年基準年月
    C                     MOVELH203      H203YM
    C                     MOVE 12        H203YM
    C                     Z-ADD*ZERO     YMD     80
    C                     MOVELH203YM    YMD
    C                     MOVE 31        YMD
    C*
    C*工作年月＝基準年月－到職日期年月＋１
    C*
    C                     Z-ADD*ZERO     WMM     40
    C                     Z-ADD*ZERO     KMM     40
    C                     Z-ADD*ZERO     WRKY    20
    C                     Z-ADD*ZERO     WRKM    20
    C                     CALL 'P33'
    C                     PARM EM13      P3301I  80       到職日
    C                     PARM YMD       P3302I  80
    C                     PARM '2'       P3303I  1
    C                     PARM '1'       P3304I  1
    C           WMM       PARM           P3311O  70
    C                     PARM           P3312O  20
    C                     ADD  1         WMM              工作總月數
    C**---------------------------------------------------------------
    C*計算留職停薪月份總數
  07-C           EM261     IFNE 0
    C           EM261     DIV  30        KMM
    C*須扣除留職停薪時段才是工作總月數
    C           WMM       SUB  KMM       WMM
  07-C                     END
    C                     Z-ADDWMM       H216
    C**---------------------------------------------------------------
    C           WMM       DIV  12        WRKY             工作年數
    C                     MVR            WRKM             工作月數
    C*
    C                     Z-ADD*ZERO     DAY     52
    C                     Z-ADD*ZERO     DAY1    52
    C                     Z-ADD*ZERO     AA      20
    C                     Z-ADD*ZERO     BB      11
    C*----------------------------------------------------------------
    C*判斷本年特休天數
  08-C                     SELEC
    C*工作年月＜１年
    C*特休天數＝０天
    C           WMM       WHLT 12
    C                     Z-ADD0         H204
    C*工作年月＞１年　且　＜２年者，
    C*特休天數＝７＊工作月／１２　
    C           WMM       WHGT 12
    C           WMM       ANDLT24
    C           WRKM      MULT 7         DAY
    C           DAY       DIV  12        DAY
    C                     Z-ADDDAY       AA
    C                     Z-ADDDAY       BB
    C                     Z-ADDAA        H204
    C*
  09-C           BB        IFGT 0.5
    C                     ADD  1         H204
  09*C                     ELSE
    C                     ADD  0.5       H204
  09-C                     END
    C*
    C*工作年月＞＝２年　且　＜＝３年者，
    C*特休天數＝７天
    C           WMM       WHGE 24
    C           WMM       ANDLE36
    C                     Z-ADD7         H204
    C*
    C*工作年月＞３年　且　＜４年者，
    C*特休天數＝（１０＊工作月／１２）＋（７＊（１２－工作月）／１２）
    C           WMM       WHGT 36
    C           WMM       ANDLT48
    C           WRKM      MULT 10        DAY1
    C           DAY1      DIV  12        DAY1
    C*
    C           12        SUB  WRKM      WRKM
    C           WRKM      MULT 7         DAY
    C           DAY       DIV  12        DAY
    C*
    C                     ADD  DAY1      DAY
    C                     Z-ADDDAY       AA
    C                     Z-ADDDAY       BB
    C                     Z-ADDAA        H204
    C*
  10-C           BB        IFGT 0.5
    C                     ADD  1         H204
  10*C                     ELSE
    C                     ADD  0.5       H204
  10-C                     END
    C*
    C*工作年月＞＝４年　且　＜＝５年者，
    C*特休天數＝１０天
    C           WMM       WHGE 48
    C           WMM       ANDLE60
    C                     Z-ADD10        H204
    C*
    C*工作年月＞５年　且　＜６年者，
    C*特休天數＝（１４＊工作月／１２）＋（１０＊（１２－工作月）／１２）
    C           WMM       WHGT 60
    C           WMM       ANDLT72
    C           WRKM      MULT 14        DAY1
    C           DAY1      DIV  12        DAY1
    C*
    C           12        SUB  WRKM      WRKM
    C           WRKM      MULT 10        DAY
    C           DAY       DIV  12        DAY
    C*
    C                     ADD  DAY1      DAY
    C                     Z-ADDDAY       AA
    C                     Z-ADDDAY       BB
    C                     Z-ADDAA        H204
    C*
  11-C           BB        IFGT 0.5
    C                     ADD  1         H204
  11*C                     ELSE
    C                     ADD  0.5       H204
  11-C                     END
    C*
    C*工作年月＞＝６年　且　＜＝１０年者，
    C*特休天數＝１４天
    C           WMM       WHGE 72
    C           WMM       ANDLE120
    C                     Z-ADD14        H204
    C*
    C*工作年月＞１０年　且　＜１１年者，
    C*特休天數＝１４＋（工作月／１２）
    C           WMM       WHGT 120
    C           WMM       ANDLT132
    C           WRKM      DIV  12        DAY
    C                     ADD  14        DAY
    C                     Z-ADDDAY       AA
    C                     Z-ADDDAY       BB
    C                     Z-ADDAA        H204
    C*
  12-C           BB        IFGT 0.5
    C                     ADD  1         H204
  12*C                     ELSE
    C                     ADD  0.5       H204
  12-C                     END
    C*
    C*工作年月＞＝１１年者，
    C*特休天數＝14天逐年累加
    C           WMM       WHGE 132
    C                     Z-ADD132       XXX     40
    C                     Z-ADD14        DAY
  13-C           WMM       DOWGEXXX
    C                     ADD  12        WXXX    40
  14-C           XXX       IFGE WXXX
    C                     ADD  12        XXX
    C                     ADD  1         DAY
  14-C                     END
  13-C                     END
    C                     Z-ADDDAY       H204
    C*
    C*特休最多加至３０天
  15-C           H204      IFGT 30
    C                     Z-ADD30        H204
  15-C                     END
    C*
  08-C                     END
    C*
    C*-------------------------------------------------------------***
    C*計算基準計薪總時數：
    C*前年未休天數＝去年年休補發。
    C*
    C                     SUB  1         WYY              去年度
    C*
    C                     Z-ADD*ZERO     HR      41       基準時數
    C*
    C                     Z-ADD*ZERO     TOT1    41
    C                     Z-ADD*ZERO     FLDT1   41       去年可休總時數
    C                     Z-ADD*ZERO     FLDT2   41       去年已休總時數
    C                     Z-ADD*ZERO     FLDT3   41       去年未休總時數
    C                     Z-ADD*ZERO     H205             年假折發－天數
    C                     Z-ADD*ZERO     H205H            年假折發－時數
    C                     Z-ADD*ZERO     H208             去年可休年假－天
    C                     Z-ADD*ZERO     H208H            去年可休年假－時
    C                     Z-ADD*ZERO     H209             去年已休年假－天
    C                     Z-ADD*ZERO     H209H            去年已休年假－時
    C                     Z-ADD*ZERO     H210             去年未休年假－天
    C                     Z-ADD*ZERO     H210H            去年未休年假－時
    C*
    C*LT10=本年度特休年假
    C*LT11=本年已休－天 LT13=去年轉休－天 LT15=明年預借－天
    C*LT12=本年已休－時 LT14=去年轉休－時 LT16=明年預借－時
    C*
    C           KEYLT1    CHAINLT0                  40
  16-C           *IN40     IFEQ '0'
    C*
    C                     Z-ADDLT15      LT15L   30
    C                     Z-ADDLT16      LT16L   10
    C*
    C           LT10      ADD  LT13      TOT1    41
    C                     ADD  LT15      TOT1
    C           TOT1      MULT 8         FLDT1   41
    C                     ADD  LT14      FLDT1
    C                     ADD  LT16      FLDT1            去年可休總時數
    C*
    C           LT11      MULT 8         FLDT2   41
    C                     ADD  LT12      FLDT2            去年已休總時數
    C*
    C           FLDT1     SUB  FLDT2     FLDT3   41       去年未休總時數
    C*                    SUB  WLU       FLDT3                    時數
    C*
  16-C                     END
    C*
    C                     ADD  1         WYY
    C*
    C*去年可休年假（天數．時數）
  17-C           FLDT1     IFNE *ZERO
    C           FLDT1     DIV  PM101     H208
    C                     MVR            H208H
  17-C                     END
    C*
    C*去年已休年假（天數．時數）
  18-C           FLDT2     IFNE *ZERO
    C           FLDT2     DIV  PM101     H209
    C                     MVR            H209H
  18-C                     END
    C*
    C*去年未休年假（天數．時數）
  13-C           FLDT3     IFNE *ZERO
    C           FLDT3     DIV  PM101     H210
    C                     MVR            H210H
  13-C                     END
    C*
    C*
    C*                    Z-ADDYSR       H206
     C                     EXSR RTN300
    C*-------------------------------------------------------------***
    C*折發金額不可小於零
  19-C           H206      IFLE *ZERO
    C                     Z-ADD*ZERO     H206
  19-C                     END
    C*
     C*940105 ALLEN SUB 1 H203    SUB 100 H207
     C*                    SUB  1         H203
     C*                    SUB  100       H207
    C                     Z-ADD$A8YMD    H297
    C                     TIME           H298
    C                     MOVEL$USER     H299
    C*
    C                     WRITEH20
  06-C                     END
    C*-------------------------------------------------------------***
    C           KEYLU1    CHAINLU0                  43
  20-C           *IN43     IFEQ '1'
    C*
    C                     MOVELH201      LU01      P      公司
    C                     MOVELH202      LU02      P      員工
    C                     Z-ADDH203      LU03             年度
    C                     Z-ADD12        LU04             月份
    C                     Z-ADDFLDT3     LU05             本年已休年假－天
    C                     Z-ADD0         LU06             本年已休年假－時
    C                     Z-ADD$A8YMD    LU97             記錄更新日期
    C                     TIME           LU98
    C                     MOVEL$USER     LU99
    C                     WRITELU0
  20-C                     END
    C*
    C*-------------------------------------------------------------***
    C           KEYLT     CHAINLT0                  43
  21-C           *IN43     IFEQ '1'
    C*
    C                     MOVELH201      LT01      P      公司
    C                     MOVELH202      LT02      P      員工
    C                     Z-ADDWYY       LT03             特休年度
    C                     Z-ADDH204      LT10             本年特休天數
    C                     Z-ADD0         LT11             本年已休年假－天
    C                     Z-ADD0         LT12             本年已休年假－時
    C                     Z-ADDH210      LT13             去年轉休年假－天
    C                     Z-ADDH210H     LT14             去年轉休年假－時
    C                     Z-ADD0         LT15             明年預借年假－天
    C                     Z-ADD0         LT16             明年預借年假－時
    C                     Z-ADDLT15L     LT17             去年已借年假－天
    C                     Z-ADDLT16L     LT18             去年已借年假－時
    C                     Z-ADD0         LT20
    C                     Z-ADD0         LT21
    C                     Z-ADD0         LT22
    C                     Z-ADD0         LT23
    C                     Z-ADD0         LT24
    C                     Z-ADD0         LT25
    C                     Z-ADD0         LT26
    C                     Z-ADD0         LT96             薪資處理月份
    C                     Z-ADD$A8YMD    LT97             記錄更新日期
    C                     TIME           LT98
    C                     MOVEL$USER     LT99
    C                     WRITELT0
  21-C                     END
    C*
  01-C                     END
     C*
     C*===============================================================
     C* RTN300
     C*==============================================================
01===C           RTN300    BEGSR
|    C*LT10=本年度特休年假
|    C*LT11=本年已休－天 LT13=去年轉休－天 LT15=明年預借－天
|    C*LT12=本年已休－時 LT14=去年轉休－時 LT16=明年預借－時
|    C*
|    C           KEYLT1    CHAINLT0                  40
| 01-C           *IN40     IFEQ '0'
|   C*
|   C           LT11      MULT 8         FLD     40
|   C           FLD       ADD  LT12      FLD
|   C*
|   C           LT10      MULT 8         FLD2    40
|   C           LT13      MULT 8         FLD3    40
|   C           FLD3      ADD  LT14      FLD3
|   C*
| 02-C           FLD       IFLE FLD2
|   C*
|   C           FLD3      MULT HSAR      H206
| 02*C                     ELSE
|   C           FLD       SUB  FLD2      FLD5    40
|   C           FLD5      MULT HSAR      H206
|   C*
| 02-C                     END
| 01-C                     END
01===C                     ENDSR
